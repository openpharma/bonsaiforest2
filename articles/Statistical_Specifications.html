<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Statistical Specifications â€¢ bonsaiforest2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Statistical Specifications">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bonsaiforest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/Statistical_Specifications.html">Statistical Specifications</a></li>
    <li><a class="dropdown-item" href="../articles/technical-details.html">Technical Details of bonsai forest Models</a></li>
    <li><a class="dropdown-item" href="../articles/using-bonsaiforest.html">Using bonsai forest for Bayesian Subgroup Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Statistical Specifications</h1>
            
      

      <div class="d-none name"><code>Statistical_Specifications.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="scope-of-this-document">1. Scope of this document<a class="anchor" aria-label="anchor" href="#scope-of-this-document"></a>
</h2>
<p>This document describes the statistical methods implemented in the
<code>bonsaiforest2</code> R package for Bayesian subgroup analysis of
continuous, binary, count, and time-to-event outcomes in randomized
clinical trials (RCTs).</p>
<p>The package unabled the implementation of both a <strong>global
modeling approach</strong> <span class="citation">(Wolbers et al.
2025)</span>, that estimates all main (prognostic) and interaction
(predictive) effects in a single model, and a <strong>One-variable-at a
time</strong> <span class="citation">(Wang et al. 2024)</span>, that
estimates the interaction effects using a different model for each
subgrouping variable. This contrasts with traditional methods that
analyze subgroups separately or one variable at a time.</p>
<p>The core features described in this document are:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Flexible Model Specification:</strong> A unified framework
to distinguish between:
<ul>
<li>
<strong>Prognostic</strong> (main) vs.Â <strong>Predictive</strong>
(interaction) effects.</li>
<li>
<strong>Shrunk</strong> vs.Â <strong>Unshrunk</strong> coefficients,
allowing exploratory terms to be penalized while pre-specified terms are
not.</li>
</ul>
</li>
<li>
<strong>Advanced Shrinkage Priors:</strong> Implementation of
state-of-the-art shrinkage priors, including the <strong>Regularized
Horseshoe</strong> <span class="citation">(Piironen and Vehtari 2017;
Wolbers et al. 2025)</span> and <strong>R2D2</strong> <span class="citation">(Zhang et al. 2022)</span>, to provide robust control
of false-positive findings while identifying potential
heterogeneity.</li>
<li>
<strong>Marginal Effect Estimation:</strong> Use of
<strong>standardization (G-computation)</strong> to derive interpretable
<em>marginal</em> subgroup treatment effects, which average over the
covariate distributions within each subgroup <span class="citation">(Wolbers et al. 2025)</span>.</li>
</ol>
<p>This document is structured as follows: Section 2 provides a
conceptual introduction to subgroup analysis challenges and the Bayesian
shrinkage solution. Section 3 details the statistical methodology,
including notation, the global and the one-variable at a time models,
endpoint-specific likelihoods, prior specifications, and the
standardization procedure. Section 4 maps these statistical methods to
the core functions in the <code>bonsaiforest2</code> package.</p>
</div>
<div class="section level2">
<h2 id="introduction-to-subgroup-analysis-and-estimation">2. Introduction to Subgroup Analysis and Estimation<a class="anchor" aria-label="anchor" href="#introduction-to-subgroup-analysis-and-estimation"></a>
</h2>
<div class="section level3">
<h3 id="the-challenge-of-subgroup-analysis">2.1 The Challenge of Subgroup Analysis<a class="anchor" aria-label="anchor" href="#the-challenge-of-subgroup-analysis"></a>
</h3>
<p>Exploratory subgroup analyses are a standard part of RCT reporting,
typically visualized in forest plots to assess the consistency of
treatment effects. However, their interpretation is notoriously
difficult due to several statistical challenges:</p>
<ul>
<li>
<strong>Low Power:</strong> Subgroups have smaller sample sizes,
leading to low precision (wide confidence intervals) and an inability to
detect true, modest differences in effect.</li>
<li>
<strong>Multiplicity:</strong> Examining many subgroups (e.g., 20 or
more) inflates the risk of false-positive findings. Investigators may
focus on the most extreme results, which are often spurious.</li>
<li>
<strong>Overfitting:</strong> Standard subgroup-specific estimates
(fitting a model only to data within that subgroup) are unbiased but
have high variance, leading to an overestimation of heterogeneity.</li>
</ul>
<p>This has led to the common recommendation that the <em>overall</em>
treatment effect is often a more reliable estimate for a subgroup than
the estimate derived from the subgroupâ€™s data alone.</p>
</div>
<div class="section level3">
<h3 id="prognostic-vs--predictive-effects">2.2 Prognostic vs.Â Predictive Effects<a class="anchor" aria-label="anchor" href="#prognostic-vs--predictive-effects"></a>
</h3>
<p>To build a meaningful model, it is crucial to distinguish how a
baseline variable relates to the outcome:</p>
<ul>
<li>
<strong>Prognostic Effect</strong>: A variable is
<strong>prognostic</strong> if it is associated with the clinical
outcome, regardless of the treatment received. It describes the natural
course of the disease. In a model, this is a <strong>main
effect</strong>.</li>
<li>
<strong>Predictive Effect</strong>: A variable is
<strong>predictive</strong> if its value modifies the magnitude or
direction of the treatmentâ€™s effect. It identifies heterogeneity. In a
model, this is a <strong>treatment-by-variable
interaction</strong>.</li>
</ul>
<p><code>bonsaiforest2</code> is built to model both types of effects
explicitly and apply different modeling strategies (e.g., shrinkage) to
each.</p>
</div>
<div class="section level3">
<h3 id="the-role-of-bayesian-shrinkage">2.3 The Role of Bayesian Shrinkage<a class="anchor" aria-label="anchor" href="#the-role-of-bayesian-shrinkage"></a>
</h3>
<p>Bayesian shrinkage methods directly address the challenges of
subgroup analysis by providing a principled compromise between the two
extremes of â€œno poolingâ€ (subgroup-specific estimates) and â€œfull
poolingâ€ (overall population estimate).</p>
<p>This compromise, often called <strong>partial pooling</strong>, is
achieved using hierarchical models. Subgroup effects are assumed to be
<em>exchangeable</em> (drawn from a common distribution). This
assumption allows subgroups to â€œborrow strengthâ€ from each other:</p>
<ul>
<li>Subgroups with <strong>small sample sizes</strong> and extreme
results are â€œshrunkâ€ heavily toward the overall mean, reducing their
variance.</li>
<li>Subgroups with <strong>large sample sizes</strong> and strong
evidence of a real effect are shrunk less, allowing their data to
dominate.</li>
</ul>
<p>This results in estimates with a better <strong>bias-variance
trade-off</strong>: we accept a small amount of bias (by pulling real
effects slightly toward the mean) in exchange for a large reduction in
variance, leading to a lower overall error and better control of
spurious findings.</p>
</div>
<div class="section level3">
<h3 id="conditional-vs--marginal-estimands">2.4 Conditional vs.Â Marginal Estimands<a class="anchor" aria-label="anchor" href="#conditional-vs--marginal-estimands"></a>
</h3>
<p>When covariates are included in a non-linear model (like a logistic
or Cox model), the resulting coefficients represent
<strong>conditional</strong> effects. For example, the treatment effect
is the effect for a patient with a <em>specific set</em> of covariate
values (e.g., the reference values).</p>
<p>This is problematic for forest plots, where we want to know the
<strong>marginal</strong> effect: â€œWhat is the average treatment effect
for <em>all patients</em> in the â€˜Femaleâ€™ subgroup, averaging over their
different ages, regions, etc.?â€.</p>
<p>Because different subgroups have different covariate distributions
(e.g., the <code>age &gt;= 65</code> subgroup will have a different
health status profile than the <code>age &lt; 65</code> group), these
conditional coefficients are not directly comparable.</p>
<p><code>bonsaiforest2</code> solves this by using
<strong>Standardization (G-computation)</strong>. This procedure
correctly averages over the specific covariate distribution of each
subgroup to estimate a valid marginal treatment effect, ensuring all
subgroups are compared on the same interpretable scale.</p>
</div>
</div>
<div class="section level2">
<h2 id="statistical-methodology">3. Statistical Methodology<a class="anchor" aria-label="anchor" href="#statistical-methodology"></a>
</h2>
<div class="section level3">
<h3 id="setting-and-notation">3.1 Setting and Notation<a class="anchor" aria-label="anchor" href="#setting-and-notation"></a>
</h3>
<p>We establish the following notation for the global model:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">i = 1, \dots, N</annotation></semantics></math>:
Index for individual patients.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>:
The outcome for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>i</mi></msub><annotation encoding="application/x-tex">s_i</annotation></semantics></math>:
The binary treatment indicator
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s_i=1</annotation></semantics></math>
for treatment,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s_i=0</annotation></semantics></math>
for control).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">l = 1, \dots, L</annotation></semantics></math>:
Index for an overall subgroup level (e.g., â€œMaleâ€, â€œFemaleâ€, â€œEUâ€,
â€œNAâ€).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub><annotation encoding="application/x-tex">x_{il}</annotation></semantics></math>:
Indicator (0/1) for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
belonging to subgroup level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
(used for prognostic effects).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>s</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{il} = s_i \cdot x_{il}</annotation></semantics></math>:
The interaction between treatment and subgroup level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
(used for predictive effects).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mrow><mi>i</mi><mi>v</mi></mrow></msub><annotation encoding="application/x-tex">u_{iv}</annotation></semantics></math>:
Value of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>v</mi><annotation encoding="application/x-tex">v</annotation></semantics></math>-th
additional non-subgroup covariate for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math>:
The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N \times 1</annotation></semantics></math>
vector of expected outcomes.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>â‹…</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>:
A link function (e.g., logit, log).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ˆ</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>:
The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N \times 1</annotation></semantics></math>
vector of the linear predictor.</li>
</ul>
</div>
<div class="section level3">
<h3 id="design-matrix-considerations">3.2. Design Matrix Considerations<a class="anchor" aria-label="anchor" href="#design-matrix-considerations"></a>
</h3>
<p>A critical implementation detail is the construction of the design
matrix for the subgroup-by-treatment interactions.</p>
<p>We will then follow the same idea as in the <code>bonsaiforest</code>
library. We will treat prognostic effects and predictive effects
differently, as they serve different purposes in the model:</p>
<ul>
<li><p><strong>For prognostic effects :</strong> The goal is
interpretability and avoiding collinearity with the intercept. Here,
standard dummy coding is the appropriate choice. For each of the J
subgrouping variables, one level is dropped as a reference, resulting in
Lâˆ’J total columns for the subgroup main effects.</p></li>
<li><p><strong>For predictive effects:</strong> The goal is to treat all
subgroup levels symmetrically under the assumption of exchangeability.
Using one-hot encoding is essential here. This ensures that the
shrinkage prior pulls all predictive effects toward a common center
without privileging a reference level.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="the-global-model">3.3 The Global Model<a class="anchor" aria-label="anchor" href="#the-global-model"></a>
</h3>
<p>The package enables the implementation of a global model <span class="citation">(Wolbers et al. 2025)</span> where all effects are
estimated in a single, comprehensive regression formula.</p>
<div class="section level4">
<h4 id="full-model-equation">3.3.1 Full Model Equation<a class="anchor" aria-label="anchor" href="#full-model-equation"></a>
</h4>
<p><strong><em>Matrix form:</em></strong></p>
<p>The model for the linear predictor,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ˆ</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>,
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
patients is given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ğ›ˆ</mi><mo>=</mo><munder><munder><mrow><msub><mi>ğ—</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Penalized prognostic effects</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>ğ—</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Non-penalized prognostic effects</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>ğ™</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Penalized predictive effects</mtext></munder><mo>+</mo></mrow><annotation encoding="application/x-tex">g(\boldsymbol{\mu}) = \boldsymbol{\eta} = \underbrace{\mathbf{X_p}\boldsymbol{\beta_{1,p}}}_{\text{Penalized prognostic effects}} +\underbrace{\mathbf{X_n}\boldsymbol{\beta_{1,n}}}_{\text{Non-penalized prognostic effects}} +\underbrace{\mathbf{Z_p}\boldsymbol{\beta_{2,p}}}_{\text{Penalized predictive effects}} +</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><munder><mrow><msub><mi>ğ™</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Non-penalized predictive effects</mtext></munder><mo>+</mo><munder><munder><mrow><mi>ğ”</mi><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Extra prognostic effects</mtext></munder></mrow><annotation encoding="application/x-tex"> \underbrace{\mathbf{Z_n}\boldsymbol{\beta_{2,n}}}_{\text{Non-penalized predictive effects}}+ \underbrace{\mathbf{U}\boldsymbol{\beta_{3}}}_{\text{Extra prognostic effects}} </annotation></semantics></math></p>
<p>The Bayesian hierarchical structure is applied as follows:</p>
<ul>
<li><p><strong>Penalized Coefficients</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,p}}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,p}}</annotation></semantics></math>
are given shrinkage priors.</p></li>
<li><p><strong>Non-Penalized Coefficients</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,n}}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,n}}</annotation></semantics></math>
are given standard, weakly informative priors.</p></li>
<li><p><strong>Extra prognostic effects Coefficients</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_3}</annotation></semantics></math>
are given standard, weakly informative priors.</p></li>
</ul>
<p><strong>Components definition:</strong></p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N \times 1</annotation></semantics></math>
vector of expected outcomes for all patients.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>â‹…</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>
is the link function (e.g., logit for binary data).</p></li>
<li>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ—</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>ğ—</mi><mi>ğ©</mi></msub><mspace width="0.278em"></mspace><mspace width="0.278em"></mspace><msub><mi>ğ—</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{X}= [\mathbf{X_p} \;\;  \mathbf{X}_n]</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">N \times M</annotation></semantics></math>
design matrix for the <strong>prognostic effects</strong><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that this is different from what they do in the
&lt;span class="citation"&gt;Wang et al. (2024)&lt;/span&gt; where they give
shrinkage priors to all the coefficients. This can also be done in our
library.&lt;/p&gt;'><sup>1</sup></a>. It typically
includes:</p>
<ul>
<li><p>An intercept column. (I guess we wonâ€™t like to penalize the
intercept so it will be contained in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ—</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\mathbf{X}_n</annotation></semantics></math>).</p></li>
<li><p>A column for the main treatment effect.</p></li>
<li>
<p>Columns for the prognostic effects of each subgroup level (using
dummy coding, so one reference level per factor is dropped). Each
prognostic effect will be contained in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ—</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\mathbf{X}_n</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ—</mi><mi>p</mi></msub><annotation encoding="application/x-tex">\mathbf{X}_p</annotation></semantics></math>
depending if we want to shrink or not the effect.</p>
<p>Example:</p>
</li>
</ul>
<table class="table">
<caption>An example design matrix for a global subgroup model.</caption>
<thead><tr class="header">
<th align="left">Patient</th>
<th align="center">Intercept</th>
<th align="center">trt</th>
<th align="center">sexF</th>
<th align="center">regionUS</th>
<th align="left">regionAsia</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p><em>Note:</em> M=1+1+L-J= 1 degree for the intercept+ 1 for the
treatment effect + L (Number of subgroups) - J(Number of variables)
because we get the reference levels out.</p>
</li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,p}}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">P \times 1</annotation></semantics></math>
vector of coefficients for the prognostic effects that we want to
shrink. We will give an shrinkage prior to this coefficients.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,n}}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>M</mi><mo>âˆ’</mo><mi>P</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">(M-P) \times 1</annotation></semantics></math>
vector of coefficients for the prognostic effects that we donâ€™t want to
shrink.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ™</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>ğ™</mi><mi>ğ©</mi></msub><mspace width="0.278em"></mspace><mspace width="0.278em"></mspace><msub><mi>ğ™</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{Z}= [\mathbf{Z_p} \;\;  \mathbf{Z}_n]</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">N \times L</annotation></semantics></math>
design matrix for the <strong>predictive effects</strong>. Its columns
represent the interaction between the treatment and each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
subgroup levels across all subgrouping variables. This matrix is
constructed without dropping a reference level to treat all subgroups
symmetrically.</p></li>
</ul>
<table class="table">
<colgroup>
<col width="10%">
<col width="14%">
<col width="14%">
<col width="19%">
<col width="19%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="center">Patient</th>
<th align="center">trt x sexM</th>
<th align="center">trt x sexF</th>
<th align="center">trt x regionEU</th>
<th align="center">trt x regionUS</th>
<th align="center">trt x regionAsia</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,p}}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R \times 1</annotation></semantics></math>
vector of coefficients for the predictive effects that we want to
shrink. We will give an shrinkage prior to this coefficients.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,n}}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo>âˆ’</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">(L-R) \times 1</annotation></semantics></math>
vector of coefficients for the predictive effects that we donâ€™t want to
shrink.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">N \times V</annotation></semantics></math>
design matrix for the extra variables we want to take into account in
the fitting of the model. This will also be
<strong>unpenalized.</strong>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_3}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">V \times 1</annotation></semantics></math>
vector of extra prognostic effects coefficients</li>
</ul>
<table class="table">
<colgroup>
<col width="25%">
<col width="37%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left"><strong>Shrinkage</strong></th>
<th align="left"><strong>Not Shrinkage</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Prognostic Effect</strong></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ—</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{X_p}\boldsymbol{\beta_{1,p}}</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ—</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{X_n}\boldsymbol{\beta_{1,n}}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td align="left"><strong>Predictive Effect</strong></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ™</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{Z_p}\boldsymbol{\beta_{2,p}}</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ™</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{Z_n}\boldsymbol{\beta_{2,n}}</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<p><strong><em>Linear form:</em></strong></p>
<p>To make it more concrete, the linear predictor for a single patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
can be written as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î·</mi><mi>i</mi></msub><mo>=</mo><munder><munder><mrow><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Î²</mi><mtext mathvariant="normal">treat</mtext></msub><msub><mi>s</mi><mi>i</mi></msub><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>P</mi></munderover><msubsup><mi>Î²</mi><mrow><mn>1</mn><mo>,</mo><mi>p</mi></mrow><mi>l</mi></msubsup><msubsup><mi>x</mi><mi>n</mi><mrow><mi>i</mi><mi>l</mi></mrow></msubsup></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">penalized</mtext></munder><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>l</mi><mo>=</mo><mi>P</mi><mo>+</mo><mn>1</mn></mrow><mi>M</mi></munderover><msubsup><mi>Î²</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi></mrow><mi>l</mi></msubsup><msubsup><mi>x</mi><mi>n</mi><mrow><mi>i</mi><mi>l</mi></mrow></msubsup></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Not penalized</mtext></munder><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>v</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><msubsup><mi>Î²</mi><mn>3</mn><mi>v</mi></msubsup><msup><mi>u</mi><mrow><mi>i</mi><mi>v</mi></mrow></msup></mrow><mo accent="true">âŸ</mo></munder><mrow><mtext mathvariant="normal">Extra </mtext><mspace width="0.333em"></mspace></mrow></munder></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Prognostic Effects</mtext></munder><mo>+</mo><munder><munder><mrow><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>L</mi><mo>âˆ’</mo><mi>R</mi></mrow></munderover><msubsup><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>p</mi></mrow><mi>l</mi></msubsup><msubsup><mi>z</mi><mi>p</mi><mrow><mi>i</mi><mi>l</mi></mrow></msubsup></mrow><mo accent="true">âŸ</mo></munder><mrow><mtext mathvariant="normal">penalized </mtext><mspace width="0.333em"></mspace></mrow></munder><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>l</mi><mo>=</mo><mi>L</mi><mo>âˆ’</mo><mi>R</mi><mo>+</mo><mn>1</mn></mrow><mi>L</mi></munderover><msubsup><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>n</mi></mrow><mi>l</mi></msubsup><msubsup><mi>z</mi><mi>n</mi><mrow><mi>i</mi><mi>l</mi></mrow></msubsup></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Not penalized</mtext></munder></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Predictive effects</mtext></munder></mrow><annotation encoding="application/x-tex">
\eta_i = \underbrace{\beta_0 + \beta_{\text{treat}}s_i + \underbrace{\sum_{l=1}^{P} \beta^l_{1,p}x^{il}_n}_\text{penalized}+ \underbrace{\sum_{l=P+1}^{M}  \beta^l_{1,n}x^{il}_n}_\text{Not penalized}+\underbrace{\sum_{v=1}^{V} \beta_{3}^vu^{iv}}_{\text{Extra }}}_{\text{Prognostic Effects}} + \underbrace{\underbrace{\sum_{l=1}^{L-R} \beta_{2,p}^l z_p^{il}}_{\text{penalized }} + \underbrace{\sum_{l=L-R+1}^{L} \beta_{2,n}^l z_n^{il}}_{\text{Not penalized}} }_{\text{Predictive effects}}
</annotation></semantics></math></p>
<p><strong>Note</strong>: See that even if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>z</mi><mrow><mi>i</mi><mi>l</mi></mrow></msup><mo>=</mo><msup><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msup><mo>â‹…</mo><msup><mi>s</mi><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">z^{il}=x^{il}\cdot s^{i}</annotation></semantics></math>,
as the prognostic effect or the predicitve effect of the same
subgrouping variable may be penalized or not, we separate it in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
in the formula.</p>
</div>
<div class="section level4">
<h4 id="example">3.3.2 Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<p>A randomized, double-blind trial comparing a new drug,
<strong>DrugX</strong>, against a <strong>placebo</strong> in patients
with hypertension.</p>
<ul>
<li>
<strong>Primary Endpoint
(</strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_{i}</annotation></semantics></math>):
Change from baseline in systolic blood pressure (SBP) in mmHg at 6
months.</li>
<li>
<strong>Subgroups of Interest</strong>:
<ul>
<li>
<strong>Age Group</strong>: <code>&lt;65</code> vs.Â <code>â‰¥65</code>
years.</li>
<li>
<strong>Sex</strong>: <code>Male</code>
vs.Â <code>Female</code>.</li>
<li>
<strong>Kidney Function</strong>: eGFR <code>&lt;60</code>
(impaired) vs.Â <code>â‰¥60</code> (normal).</li>
</ul>
</li>
<li>
<strong>Covariates</strong>: <code>BaselineSBPáµ¢</code>,
<code>BMIáµ¢</code>, <code>Smokeráµ¢</code> (binary).</li>
</ul>
<p><strong>Global Model with Shrinkage</strong></p>
<p>The outcome is assumed to be normally distributed:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>,</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_{i} \sim N(\mu_{i}, \sigma^2)</annotation></semantics></math>.</p>
<p>The linear predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_{i}</annotation></semantics></math>
is modeled as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><munder><munder><msub><mi>Î²</mi><mn>0</mn></msub><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Intercept</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î²</mi><mtext mathvariant="normal">treat</mtext></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Main Trt Effect</mtext></munder><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>Î±</mi><mi>k</mi></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Subgroup</mtext><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Prognostic Subgroup Effects</mtext></munder><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>Î³</mi><mi>k</mi></msub><mo>â‹…</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">Subgroup</mtext><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Shrunken Predictive Effects</mtext></munder><mo>+</mo><munder><munder><mrow><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></munderover><msub><mi>Î´</mi><mi>j</mi></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Covariate</mtext><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Extra Prognostic effects</mtext></munder></mrow><annotation encoding="application/x-tex">
\mu_{i} = \underbrace{\beta_0}_{\text{Intercept}} + \underbrace{\beta_{\text{treat}} \cdot \text{Treatment}_i}_{\text{Main Trt Effect}} + \underbrace{\sum_{k=1}^{K} \alpha_k \cdot \text{Subgroup}_{ik}}_{\text{Prognostic Subgroup Effects}} + \underbrace{\sum_{k=1}^{K} \gamma_k \cdot (\text{Subgroup}_{ik} \cdot \text{Treatment}_i)}_{\text{Shrunken Predictive Effects}} + \underbrace{\sum_{j=1}^{J} \delta_j \cdot \text{Covariate}_{ij}}_{\text{Extra Prognostic effects}}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><munder><munder><msub><mi>Î²</mi><mn>0</mn></msub><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Intercept</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î²</mi><mtext mathvariant="normal">treat</mtext></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Main Trt Effect</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î±</mi><mn>1</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Age Group</mtext><mi>i</mi></msub><mo>+</mo><msub><mi>Î±</mi><mn>2</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Sex</mtext><mi>i</mi></msub><mo>+</mo><msub><mi>Î±</mi><mn>3</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">eGFR</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Prognostic Subgroup Effects</mtext></munder><mo>+</mo></mrow><annotation encoding="application/x-tex">
=\underbrace{\beta_0}_{\text{Intercept}} + \underbrace{\beta_{\text{treat}} \cdot \text{Treatment}_i}_{\text{Main Trt Effect}} + \underbrace{\alpha_1 \cdot \text{Age Group}_i+\alpha_2 \cdot \text{Sex}_i+\alpha_3 \cdot \text{eGFR}_i}_{\text{Prognostic Subgroup Effects}}+
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><munder><munder><mrow><msub><mi>Î³</mi><mn>1</mn></msub><mo>â‹…</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">Age Group</mtext><mi>i</mi></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Î³</mi><mn>2</mn></msub><mo>â‹…</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">Sex</mtext><mi>i</mi></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>Î³</mi><mn>3</mn></msub><mo>â‹…</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">eGFR</mtext><mi>i</mi></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Predictive Effects</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î´</mi><mn>1</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">BaselineSBP</mtext><mi>i</mi></msub><mo>+</mo><msub><mi>Î´</mi><mn>2</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">BMI</mtext><mi>i</mi></msub><mo>+</mo><msub><mi>Î´</mi><mn>3</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Smoker</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Extra Prognostic effects</mtext></munder></mrow><annotation encoding="application/x-tex">
+ \underbrace{\gamma_1 \cdot (\text{Age Group}_i\cdot \text{Treatment}_i)+\gamma_2 \cdot (\text{Sex}_i\cdot \text{Treatment}_i)+\gamma_3 \cdot (\text{eGFR}_i\cdot \text{Treatment}_i)}_{\text{Predictive Effects}} + \underbrace{\delta_1 \cdot \text{BaselineSBP}_i+\delta_2 \cdot \text{BMI}_i+\delta_3 \cdot \text{Smoker}_i}_{\text{Extra Prognostic effects}}
</annotation></semantics></math></p>
</div>
</div>
<div class="section level3">
<h3 id="one-variable-at-a-time-model">3.4. One-Variable-at-a-Time Model<a class="anchor" aria-label="anchor" href="#one-variable-at-a-time-model"></a>
</h3>
<p>The <strong>one-variable-at-a-time model</strong> <span class="citation">(Wang et al. 2024)</span> is a Bayesian hierarchical
model (BHM) that improves upon standard subgroup analysis by borrowing
information across subgroup levels to produce more stable and reliable
estimates. Instead of analyzing each subgroup level in isolation, it
analyzes all levels <em>within a single subgrouping variable</em> (e.g.,
all age groups) together in one model.</p>
<p>For example, for the variable <em>Sex</em> (with levels Male and
Female), you would fit one hierarchical model. In this single model, the
treatment effects for Male
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mtext mathvariant="normal">sex,male</mtext></mrow></msub><annotation encoding="application/x-tex">\beta_{2,\text{sex,male}}</annotation></semantics></math>)
and Female
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mtext mathvariant="normal">sex,female</mtext></mrow></msub><annotation encoding="application/x-tex">\beta_{2,\text{sex,female}}</annotation></semantics></math>)
are treated as exchangeable and are linked by a common prior
distribution. Then, a completely separate hierarchical model would be
fit for the variable <em>Region</em>.</p>
<div class="section level4">
<h4 id="full-model-equation-1">3.4.1 Full Model Equation<a class="anchor" aria-label="anchor" href="#full-model-equation-1"></a>
</h4>
<p>For a given subgrouping variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
we can specify a flexible linear predictor that allows for some
covariate effects to be constant across the levels of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
while others are allowed to vary.</p>
<p>Letâ€™s partition the patient-level covariates into two sets:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ®</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{u}_i</annotation></semantics></math>:
A vector of covariates assumed to have a <strong>constant prognostic
effect</strong> across all levels of the subgrouping variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ¯</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{v}_i</annotation></semantics></math>:
A vector of covariates for which there is a strong <em>a priori</em>
reason to believe their prognostic effect <strong>varies</strong> across
the levels
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
of the subgrouping variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.</p></li>
</ul>
<p>The linear predictor for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
of variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
is then:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Î²</mi><mrow><mn>1</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><mo>+</mo><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><msub><mi>z</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ğ›ƒ</mi><mrow><mn>3</mn><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>ğ®</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ğ›ƒ</mi><mrow><mn>4</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><msub><mi>ğ¯</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">g(\mu_{i,j,k}) = \beta_{1,j,k} + \beta_{2,j,k}z_i + \boldsymbol{\beta}_{3,j}\mathbf{u}_i + \boldsymbol{\beta}_{4,j,k}\mathbf{v}_i</annotation></semantics></math></p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{2,j,k}</annotation></semantics></math>:
The predictive effect for level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
of variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.
This is the primary parameter of interest for shrinkage.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›ƒ</mi><mrow><mn>3</mn><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>ğ®</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\beta}_{3,j}\mathbf{u}_i</annotation></semantics></math>:
The effect of covariates assumed to be <strong>constant</strong> across
levels. The coefficient vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>3</mn><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{3,j}</annotation></semantics></math>
does <strong>not</strong> have a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
subscript.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›ƒ</mi><mrow><mn>4</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><msub><mi>ğ¯</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\beta}_{4,j,k}\mathbf{v}_i</annotation></semantics></math>:
The effect of covariates assumed to be <strong>level-specific</strong>.
The coefficient vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>4</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{4,j,k}</annotation></semantics></math><strong>does</strong> have a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
subscript, allowing its effect to be different for each subgroup level.
This can be seen as an interaction between variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mi>i</mi></msub><annotation encoding="application/x-tex">v_i</annotation></semantics></math>.</li>
</ul>
<p>Note that for coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>3</mn><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{3,j}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>4</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{4,j,k}</annotation></semantics></math>
we can use shrinkage or standard priors depending in our prior
beliefs.</p>
</div>
<div class="section level4">
<h4 id="example-1">3.4.2 Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h4>
<p>Similarly to the example showed for the Global model. The example
below is for the <strong>Age Group</strong> variable, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>âˆˆ</mo><mo stretchy="false" form="prefix">{</mo><mtext mathvariant="normal">&lt;65</mtext><mo>,</mo><mtext mathvariant="normal">â‰¥65</mtext><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">k \in \{ \text{&lt;65}, \text{â‰¥65} \}</annotation></semantics></math>.</p>
<p>The outcome for a patient <em>i</em> in age subgroup <em>k</em> is:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>k</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_{ik} \sim N(\mu_{ik}, \sigma_k^2)</annotation></semantics></math>.</p>
<p>The linear predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{ik}</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>=</mo><munder><munder><msub><mi>Î²</mi><mrow><mn>1</mn><mo>,</mo><mi>k</mi></mrow></msub><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Subgroup Intercept</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>k</mi></mrow></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Predictive Effect</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î´</mi><mn>1</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">BMI</mtext><mi>i</mi></msub><mo>+</mo><msub><mi>Î´</mi><mn>2</mn></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">Smoker</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Constant Prognostic Effects</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>Î´</mi><mrow><mn>3</mn><mo>,</mo><mi>k</mi></mrow></msub><mo>â‹…</mo><msub><mtext mathvariant="normal">BaselineSBP</mtext><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Varying Prognostic Effect</mtext></munder></mrow><annotation encoding="application/x-tex">
\mu_{ik} = \underbrace{\beta_{1,k}}_{\text{Subgroup Intercept}} + \underbrace{\beta_{2,k} \cdot \text{Treatment}_i}_{\text{Predictive Effect}} + \underbrace{\delta_1 \cdot \text{BMI}_i + \delta_2 \cdot \text{Smoker}_i}_{\text{Constant Prognostic Effects}} + \underbrace{\delta_{3,k} \cdot \text{BaselineSBP}_i}_{\text{Varying Prognostic Effect}}
</annotation></semantics></math></p>
<ul>
<li>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mrow><mn>1</mn><mo>,</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{1,k}</annotation></semantics></math>
(subgroup-specific intercept) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{2,k}</annotation></semantics></math>
(subgroup-specific predictive effect) are given hierarchical priors to
borrow information across age groups. For example:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>k</mi></mrow></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mn>2</mn></msub><mo>,</mo><msubsup><mi>Ï„</mi><mn>2</mn><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_{2,k} \sim N(\mu_2, \tau_2^2)</annotation></semantics></math>.</li>
<li>The effect of Baseline SBP is also allowed to vary by age group
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î´</mi><mrow><mn>3</mn><mo>,</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\delta_{3,k}</annotation></semantics></math>),
while BMI and Smoking effects are assumed constant</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="endpoint-specific-models">3.5 Endpoint-Specific Models<a class="anchor" aria-label="anchor" href="#endpoint-specific-models"></a>
</h3>
<p>The package supports four primary endpoint types by specifying the
appropriate likelihood and link function for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ğ›ˆ</mi></mrow><annotation encoding="application/x-tex">g(\boldsymbol{\mu}) = \boldsymbol{\eta}</annotation></semantics></math>.</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">Endpoint</th>
<th align="left">Distribution / Model</th>
<th align="left">Link Function</th>
<th align="left">Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Continuous</strong></td>
<td align="left">Normal:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>,</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim N(\mu_i, \sigma^2)</annotation></semantics></math>
</td>
<td align="left">Identity:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Î·</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mu_i = \eta_i</annotation></semantics></math>
</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
can be stratified (e.g., <code>sigma ~ 0 + clinic_site</code>).</td>
</tr>
<tr class="even">
<td align="left"><strong>Binary</strong></td>
<td align="left">Bernoulli:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">Bernoulli</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim \text{Bernoulli}(p_i)</annotation></semantics></math>
</td>
<td align="left">Logit:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Î·</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\text{logit}(p_i) = \eta_i</annotation></semantics></math>
</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><strong>Count</strong></td>
<td align="left">Negative Binomial:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">NegBin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim \text{NegBin}(\mu_i, \phi)</annotation></semantics></math>
</td>
<td align="left">Log:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Î·</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\log(\mu_i) = \eta_i</annotation></semantics></math>
</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
(overdispersion) can be stratified. Supports <code><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset()</a></code>.</td>
</tr>
<tr class="even">
<td align="left"><strong>Time-to-event</strong></td>
<td align="left">Cox Proportional Hazards:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î·</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_i(t) = h_0(t)\exp(\eta_i)</annotation></semantics></math>
</td>
<td align="left">Log (on the hazard)</td>
<td align="left">Intercept is absorbed by the baseline hazard
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_0(t)</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_0(t)</annotation></semantics></math>
can be stratified.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="prior-specifications">3.6 Prior Specifications<a class="anchor" aria-label="anchor" href="#prior-specifications"></a>
</h3>
<div class="section level4">
<h4 id="weakly-informative-priors-unshrunk-terms">3.6.1 Weakly Informative Priors (Unshrunk Terms)<a class="anchor" aria-label="anchor" href="#weakly-informative-priors-unshrunk-terms"></a>
</h4>
<p>For all non-penalized coefficients
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><mo>,</mo><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><mo>,</mo><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,n}}, \boldsymbol{\beta_{2,n}}, \boldsymbol{\beta_{3}}</annotation></semantics></math>),
we use weakly informative priors to aid computational stability without
strongly influencing the posterior.</p>
<ul>
<li>
<strong>Default:</strong> <code>normal(0, 10)</code>. This is a
common, weakly regularizing prior on the linear predictor scale. Users
can specify their own, e.g., <code>student_t(3, 0, 2.5)</code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="regularized-horseshoe-prior-shrunk-terms">3.6.2 Regularized Horseshoe Prior (Shrunk Terms)<a class="anchor" aria-label="anchor" href="#regularized-horseshoe-prior-shrunk-terms"></a>
</h4>
<p>This is the default shrinkage prior in <code>bonsaiforest2</code>,
recommended for its excellent adaptive shrinkage properties <span class="citation">(Wolbers et al. 2025; Piironen and Vehtari
2017)</span>.</p>
<ul>
<li>
<strong>Concept:</strong> A global-local prior. It has an infinitely
tall spike at zero (to aggressively shrink noise) and heavy tails (to
leave true, large signals unshrunk) .</li>
<li>
<strong>Hierarchical Specification</strong> :</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>l</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>Ï„</mi><mn>2</mn></msup><msubsup><mover><mi>Î»</mi><mo accent="true">Ìƒ</mo></mover><mi>l</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mover><mi>Î»</mi><mo accent="true">Ìƒ</mo></mover><mi>l</mi><mn>2</mn></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><msup><mi>c</mi><mn>2</mn></msup><msubsup><mi>Î»</mi><mi>l</mi><mn>2</mn></msubsup></mrow><mrow><msup><mi>c</mi><mn>2</mn></msup><mo>+</mo><msup><mi>Ï„</mi><mn>2</mn></msup><msubsup><mi>Î»</mi><mi>l</mi><mn>2</mn></msubsup></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î»</mi><mi>l</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><msup><mi>C</mi><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Local shrinkage</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï„</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><msup><mi>C</mi><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>Ï„</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Global shrinkage</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>c</mi><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Inverse-Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î½</mi><mi>/</mi><mn>2</mn><mo>,</mo><mi>Î½</mi><msup><mi>s</mi><mn>2</mn></msup><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
      \beta_{2,l} &amp;\sim N(0, \tau^2 \tilde{\lambda}_l^2) \\
      \tilde{\lambda}_l^2 &amp;= \frac{c^2 \lambda_l^2}{c^2 + \tau^2 \lambda_l^2} \\
      \lambda_l &amp;\sim C^+(0, 1) \quad (\text{Local shrinkage}) \\
      \tau &amp;\sim C^+(0, \tau_0) \quad (\text{Global shrinkage}) \\
      c^2 &amp;\sim \text{Inverse-Gamma}(\nu/2, \nu s^2/2)
      \end{aligned}
      </annotation></semantics></math></p>
<ul>
<li>
<strong>Hyperparameter Justification</strong>: The package supports
two ways to set the crucial global scale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\tau_0</annotation></semantics></math>:
<ol style="list-style-type: decimal">
<li>
<strong>Fixed Default (<code>scale_global</code>):</strong>
<code>horseshoe(scale_global = 1)</code>. This is the package default, a
robust, general-purpose choice <span class="citation">(Wolbers et al.
2025)</span>.</li>
<li>
<strong>Elicited Prior (<code>par_ratio</code>):</strong> Sets
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\tau_0</annotation></semantics></math>
based on the <em>prior</em> belief about the number of effective
(non-zero) subgroups,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><annotation encoding="application/x-tex">p_{eff}</annotation></semantics></math>,
out of the total
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math><span class="citation">(Bornkamp 2025; Piironen and Vehtari
2017)</span>. This is specified via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">par_ratio</mtext><mo>=</mo><mfrac><msub><mi>p</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><mrow><mi>L</mi><mo>âˆ’</mo><msub><mi>p</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{par_ratio} = \frac{p_{eff}}{L - p_{eff}}</annotation></semantics></math>.
This scales the prior based on sample size
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>)
and the expected sparsity.</li>
</ol>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="r2d2-prior-shrunk-terms">3.6.3 R2D2 Prior (Shrunk Terms)<a class="anchor" aria-label="anchor" href="#r2d2-prior-shrunk-terms"></a>
</h4>
<ul>
<li><p><strong>Concept:</strong> This prior is uniquely derived by first
placing a prior on the modelâ€™s coefficient of determination,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>,
which quantifies the proportion of variance explained by the predictors.
This is arguably more intuitive than specifying priors directly on
coefficients.</p></li>
<li><p><strong>Hierarchical Specification (Marginal Version):</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>l</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mi>D</mi><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ïƒ</mi><msqrt><mrow><msub><mi>Ï•</mi><mi>l</mi></msub><mi>Ï‰</mi><mi>/</mi><mn>2</mn></mrow></msqrt><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Double-Exponential/Laplace kernel</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>ğ›Ÿ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï•</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Ï•</mi><mi>L</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ¼</mo><mtext mathvariant="normal">Dirichlet</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>Ï€</mi></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>a</mi><mi>Ï€</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Local shrinkage</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï‰</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Beta-Prime</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Global shrinkage</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
  \begin{aligned}
  \beta_{2,l} &amp;\sim DE(\sigma \sqrt{\phi_l \omega / 2}) \quad (\text{Double-Exponential/Laplace kernel}) \\
  \boldsymbol{\phi} &amp;= (\phi_1, \dots, \phi_L) \sim \text{Dirichlet}(a_\pi, \dots, a_\pi) \quad (\text{Local shrinkage}) \\
  \omega &amp;\sim \text{Beta-Prime}(a, b) \quad (\text{Global shrinkage})
  \end{aligned}
  </annotation></semantics></math> This is equivalent to assuming that
the proportion of variance explained by the interaction terms follows
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mo>=</mo><mfrac><mi>Ï‰</mi><mrow><mn>1</mn><mo>+</mo><mi>Ï‰</mi></mrow></mfrac><mo>âˆ¼</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R^2 = \frac{\omega}{1+\omega} \sim \text{Beta}(a,b)</annotation></semantics></math>.</p></li>
<li>
<p><strong>Justification of Hyperparameters:</strong></p>
<ul>
<li><p><span class="citation">Zhang et al. (2022)</span> provide clear
guidance. A fully automatic approach is to set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">b=0.5</annotation></semantics></math>
to achieve Cauchy-like heavy tails.</p></li>
<li><p>The concentration parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>
controls sparsity. A smaller
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>
(e.g., 0.2) implies higher shrinkage, concentrating the prior variance
on fewer coefficients, while a larger
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>
(e.g., 0.5) spreads the variance more evenly, implying lower
shrinkage.</p></li>
<li>
<p><strong>Default Recommendation:</strong> Set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">b=0.5</annotation></semantics></math>
and offer options for the user based on desired shrinkage strength:</p>
<ul>
<li><p><strong>High Shrinkage:</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>Ï€</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">a_\pi=0.2</annotation></semantics></math></p></li>
<li><p><strong>Low Shrinkage:</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>Ï€</mi></msub><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">a_\pi=0.5</annotation></semantics></math></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="normal-hierarchical-prior-for-one-variable-at-a-time-model">3.6.4. Normal Hierarchical Prior (for One-Variable-at-a-Time
Model)<a class="anchor" aria-label="anchor" href="#normal-hierarchical-prior-for-one-variable-at-a-time-model"></a>
</h4>
<p>This is the standard hierarchical model for subgroup analysis, which
assumes that treatment effects for levels within a subgrouping variable
are drawn from a common normal distribution. Itâ€™s less complex than the
Horseshoe or R2D2 priors but provides effective shrinkage, especially
when the number of subgroup levels is small.</p>
<ul>
<li>
<strong>Hierarchical Specification:</strong> For a given subgrouping
variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
with levels
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>K</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">k=1, \dots, K_j</annotation></semantics></math>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mi>ğ’©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi></mrow></msub><mo>,</mo><msubsup><mi>Ï„</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Level-specific treatment effects</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mi>ğ’©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>s</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Common mean effect</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Ï„</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Half-Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Between-subgroup heterogeneity</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \beta_{2,j,k} &amp;\sim \mathcal{N}(\mu_{2,j}, \tau^2_{2,j}) \quad (\text{Level-specific treatment effects}) \\
    \mu_{2,j} &amp;\sim \mathcal{N}(0, s^2) \quad (\text{Common mean effect}) \\ \tau_{2,j} &amp;\sim \text{Half-Normal}(a) \quad (\text{Between-subgroup heterogeneity}) \end{aligned}
    </annotation></semantics></math></p>
<ul>
<li>
<strong>Justification of Hyperparameters:</strong> The key is
setting the scale parameter a for the Half-Normal prior on the
between-subgroup standard deviation,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mrow><mn>2</mn><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\tau_{2,j}</annotation></semantics></math>,
as this controls the degree of shrinkage. As recommended by <span class="citation">Bornkamp (2025)</span>, this can be linked to the
planned treatment effect (
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î´</mi><mrow><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">\delta_{plan}</annotation></semantics></math>)
from the trial protocol, making the prior choice interpretable and
consistent across different endpoints. The choice of a implies a prior
on the plausible difference in treatment effects between any two
subgroups.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="estimation-mcmc">3.7 Estimation (MCMC)<a class="anchor" aria-label="anchor" href="#estimation-mcmc"></a>
</h3>
<p>The joint posterior distribution of all parameters is complex and has
no closed-form solution. We use Markov Chain Monte Carlo (MCMC) methods
to draw samples from this distribution. Specifically, the package uses
the <strong>No-U-Turn Sampler (NUTS)</strong>, an efficient variant of
Hamiltonian Monte Carlo (HMC), as implemented in <strong>Stan</strong>
via the <code>brms</code> package. The output is a set of posterior
samples (e.g., 4000 draws) representing the joint posterior
distribution.</p>
</div>
<div class="section level3">
<h3 id="standardization-for-marginal-effects-g-computation">3.8 Standardization for Marginal Effects (G-computation)<a class="anchor" aria-label="anchor" href="#standardization-for-marginal-effects-g-computation"></a>
</h3>
<p>To obtain interpretable <em>marginal</em> effects for each subgroup,
the package implements a standardization (G-computation) procedure. This
process is repeated for <em>each</em> MCMC draw to generate a full
posterior distribution of the marginal effect.</p>
<p><strong>For a single MCMC draw, the step-by-step process
is:</strong></p>
<ol style="list-style-type: decimal">
<li><p><strong>Select Parameters:</strong> Take one draw from the joint
posterior distribution for all model parameters (all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ƒ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>â€™s,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>,
etc.).</p></li>
<li>
<p><strong>Create Counterfactuals:</strong> For <em>every
patient</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in the original dataset, create two scenarios:</p>
<ul>
<li>Scenario A: Patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>â€™s
covariates, with treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s_i=0</annotation></semantics></math>
(Control).</li>
<li>Scenario B: Patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>â€™s
covariates, with treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s_i=1</annotation></semantics></math>
(Treatment).</li>
</ul>
</li>
<li><p><strong>Predict Outcomes:</strong> Use the model formula and the
parameters from Step 1 to predict the outcome for <em>every patient</em>
under both Scenario A
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>i</mi><mo>,</mo><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">\hat{\mu}_{i,0}</annotation></semantics></math>)
and Scenario B
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\hat{\mu}_{i,1}</annotation></semantics></math>).</p></li>
<li>
<p><strong>Average within Subgroups:</strong> For a subgroup of
interest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
(e.g., â€œFemaleâ€):</p>
<ul>
<li>Calculate the average predicted outcome under control:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>=</mo><mtext mathvariant="normal">mean</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>i</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu}_{l,0} = \text{mean}(\hat{\mu}_{i,0})</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_{il}=1</annotation></semantics></math>.</li>
<li>Calculate the average predicted outcome under treatment:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>=</mo><mtext mathvariant="normal">mean</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>i</mi><mo>,</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu}_{l,1} = \text{mean}(\hat{\mu}_{i,1})</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_{il}=1</annotation></semantics></math>.</li>
</ul>
</li>
<li>
<p><strong>Calculate Effect Measure:</strong> Compute the marginal
effect for subgroup
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
from these averaged predictions. This depends on the endpoint type:</p>
<ul>
<li>
<strong>Continuous:</strong> Mean Difference =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>0</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\hat{\mu}_{l,1} - \hat{\mu}_{l,0}</annotation></semantics></math>.</li>
<li>
<strong>Binary:</strong> Odds Ratio =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>1</mn></mrow></msub><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>0</mn></mrow></msub><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><annotation encoding="application/x-tex">\frac{\hat{\mu}_{l,1} / (1 - \hat{\mu}_{l,1})}{\hat{\mu}_{l,0} / (1 - \hat{\mu}_{l,0})}</annotation></semantics></math>
(where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><annotation encoding="application/x-tex">\hat{\mu}</annotation></semantics></math>
is the predicted probability).</li>
<li>
<strong>Count:</strong> Rate Ratio =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>1</mn></mrow></msub><mi>/</mi><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>0</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\hat{\mu}_{l,1} / \hat{\mu}_{l,0}</annotation></semantics></math>
(where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><annotation encoding="application/x-tex">\hat{\mu}</annotation></semantics></math>
is the predicted rate).</li>
<li>
<strong>Time-to-Event:</strong> Average Hazard Ratio (AHR). This is
the most complex, as it requires predicting the full survival curve
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S_i(t)</annotation></semantics></math>
for each patient. The marginal survival curves
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>S</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>0</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{S}_{l,0}(t)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>S</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{S}_{l,1}(t)</annotation></semantics></math>
are calculated, and the AHR is computed from them, as the marginal
curves may not be proportional.</li>
</ul>
</li>
<li><p><strong>Repeat:</strong> This process (Steps 1-5) is repeated for
all MCMC draws, yielding a full posterior distribution (e.g., 4000
values) for the marginal effect of each subgroup. The final point
estimate (median) and 95% credible interval are taken from this
distribution.</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="mapping-of-statistical-methods-to-bonsaiforest2-functions">4. Mapping of Statistical Methods to <code>bonsaiforest2</code>
Functions<a class="anchor" aria-label="anchor" href="#mapping-of-statistical-methods-to-bonsaiforest2-functions"></a>
</h2>
<p>This section connects the statistical methodology (Section 3) to the
core package functions.</p>
<ul>
<li>
<p><strong><code><a href="../reference/run_brms_analysis.html">run_brms_analysis()</a></code></strong></p>
<ul>
<li>
<strong>Maps to:</strong> Sections 3.2 (Global Model), 3.3
(Endpoints), 3.4 (Priors), 3.5 (Estimation).</li>
<li>
<strong>Action:</strong> This function is the primary model-fitting
engine.
<ul>
<li>It constructs the design matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ—</mi><mi>ğ§</mi></msub><mo>,</mo><msub><mi>ğ—</mi><mi>ğ©</mi></msub><mo>,</mo><msub><mi>ğ™</mi><mi>ğ§</mi></msub><mo>,</mo><msub><mi>ğ™</mi><mi>ğ©</mi></msub><mo>,</mo><mi>ğ”</mi></mrow><annotation encoding="application/x-tex">\mathbf{X_n}, \mathbf{X_p}, \mathbf{Z_n}, \mathbf{Z_p}, \mathbf{U}</annotation></semantics></math>
based on the formula string arguments (e.g.,
<code>unshrunk_prognostic_formula_str</code>,
<code>shrunk_predictive_formula_str</code>).</li>
<li>It assigns the specified priors (e.g.,
<code>predictive_effect_priors = list(shrunk = "horseshoe(par_ratio = 0.1)")</code>).</li>
<li>It builds and passes the full <code>brmsformula</code> and data to
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> to run the Stan MCMC sampler.</li>
<li>It handles stratification via the
<code>stratification_formula_str</code> argument, which adds terms like
<code>bhaz(country)</code> or <code>sigma ~ country</code> to the
<code>brmsformula</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects()</a></code></strong></p>
<ul>
<li>
<strong>Maps to:</strong> Section 3.6 (Standardization /
G-computation).</li>
<li>
<strong>Action:</strong> This function implements the full
G-computation procedure.
<ul>
<li>It takes the fitted <code>brms_fit</code> object (containing
posterior samples) and the <code>original_data</code>.</li>
<li>It automatically detects the subgroups specified in the model (or
uses the <code>subgroup_vars</code> argument).</li>
<li>It iterates through each posterior sample, generates counterfactual
predictions, averages within subgroups, and calculates the marginal
effect measure (e.g., AHR, OR) based on the
<code>response_type</code>.</li>
<li>It returns a <code>subgroup_summary</code> object containing the
posterior distributions of the marginal effects.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code></strong></p>
<ul>
<li>
<strong>Maps to:</strong> Final visualization of Section 3.6
results.</li>
<li>
<strong>Action:</strong> This is a method for
<code>subgroup_summary</code> objects. It takes the summarized posterior
distributions (median and 95% CrI) for the overall and subgroup effects
and generates a forest plot.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">5. References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bornkamp2025benchmarking" class="csl-entry">
Bornkamp, BjÃ¶rn. 2025. <span>â€œ<span class="nocase">Benchmarking Bayesian
subgroup shrinkage methods on clinical data</span>.â€</span> In <em>PSI
Conference 2025</em>. London, UK.
</div>
<div id="ref-piironen2017sparsity" class="csl-entry">
Piironen, J., and A. Vehtari. 2017. <span>â€œ<span class="nocase">Sparsity
information and regularization in the horseshoe and other shrinkage
priors</span>.â€</span> <em>Electronic Journal of Statistics</em> 11:
5018â€“51.
</div>
<div id="ref-wang2024bayesian" class="csl-entry">
Wang, Yun, Wenda Tu, William Koh, James Travis, Robert Abugov, Kiya
Hamilton, Mengjie Zheng, Roberto Crackel, Pablo Bonangelino, and Mark
Rothmann. 2024. <span>â€œ<span class="nocase">Bayesian hierarchical models
for subgroup analysis</span>.â€</span> <em>Pharmaceutical Statistics</em>
23: 1065â€“83.
</div>
<div id="ref-wolbers2025using" class="csl-entry">
Wolbers, Marcel, Mar VÃ¡zquez RabuÃ±al, Ke Li, Kaspar Rufibach, and Daniel
SabanÃ©s BovÃ©. 2025. <span>â€œ<span class="nocase">Using shrinkage methods
to estimate treatment effects in overlapping subgroups in randomized
clinical trials with a time-to-event endpoint</span>.â€</span>
<em>Statistical Methods in Medical Research</em>, 1â€“12.
</div>
<div id="ref-zhang2022bayesian" class="csl-entry">
Zhang, Yan Dora, Brian P. Naughton, Howard D. Bondell, and Brian J.
Reich. 2022. <span>â€œ<span class="nocase">Bayesian regression using a
prior on the model fit: The R2-D2 shrinkage prior</span>.â€</span>
<em>Journal of the American Statistical Association</em> 117 (538):
862â€“74.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miriam Pedrera Gomez, Isaac Gravestock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
