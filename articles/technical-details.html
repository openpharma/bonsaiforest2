<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Technical Details of bonsai forest Models â€¢ bonsaiforest2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details of bonsai forest Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bonsaiforest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/Statistical_Specifications.html">Statistical Specifications</a></li>
    <li><a class="dropdown-item" href="../articles/technical-details.html">Technical Details of bonsai forest Models</a></li>
    <li><a class="dropdown-item" href="../articles/using-bonsaiforest.html">Using bonsai forest for Bayesian Subgroup Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Technical Details of bonsai forest Models</h1>
            
      

      <div class="d-none name"><code>technical-details.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette details the statistical framework, notation, models,
and prior specifications implemented within the
<code>bonsaiforest2</code> package. It is intended for users seeking a
deeper understanding of the underlying methodology used for Bayesian
subgroup analysis.</p>
<p>For a practical guide on how to use the package functions, please see
the main user guide vignette:
<code><a href="../articles/using-bonsaiforest.html">vignette("using-bonsaiforest", package = "bonsaiforest2")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="general-model-framework">General Model Framework<a class="anchor" aria-label="anchor" href="#general-model-framework"></a>
</h2>
<div class="section level3">
<h3 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h3>
<p>We establish the following notation:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">i = 1, \dots, N</annotation></semantics></math>:
Index for individual patients.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>:
The outcome for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>i</mi></msub><annotation encoding="application/x-tex">s_i</annotation></semantics></math>:
The binary treatment indicator for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s_i=1</annotation></semantics></math>
for treatment,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s_i=0</annotation></semantics></math>
for control).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">j = 1, \dots, J</annotation></semantics></math>:
Index for the subgrouping <em>variable</em> (e.g., age group,
region).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>K</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">k = 1, \dots, K_j</annotation></semantics></math>:
Index for the subgroup <em>level</em> within variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">l = 1, \dots, L</annotation></semantics></math>:
Index for an overall subgroup level across all variables
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></msubsup><msub><mi>K</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">L = \sum_{j=1}^{J} K_j</annotation></semantics></math>).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub><annotation encoding="application/x-tex">x_{il}</annotation></semantics></math>:
Indicator variable (0/1) for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
belonging to overall subgroup level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>s</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{il} = s_i \cdot x_{il}</annotation></semantics></math>:
The interaction between treatment and subgroup level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mrow><mi>i</mi><mi>v</mi></mrow></msub><annotation encoding="application/x-tex">u_{iv}</annotation></semantics></math>:
Value of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>v</mi><annotation encoding="application/x-tex">v</annotation></semantics></math>-th
additional non-subgroup covariate for patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="prognostic-vs--predictive-effects">Prognostic vs.Â Predictive Effects<a class="anchor" aria-label="anchor" href="#prognostic-vs--predictive-effects"></a>
</h3>
<p>In clinical trials, baseline characteristics can relate to outcomes
in two ways:</p>
<ul>
<li>
<strong>Prognostic Effect</strong>: Association with the outcome,
irrespective of treatment (a <strong>main effect</strong>).</li>
<li>
<strong>Predictive Effect</strong>: Modifies the treatment effect (a
<strong>treatment-by-variable interaction</strong>).</li>
</ul>
<p><code>bonsaiforest2</code> explicitly models both types of
effects.</p>
</div>
<div class="section level3">
<h3 id="design-matrix-considerations">Design Matrix Considerations<a class="anchor" aria-label="anchor" href="#design-matrix-considerations"></a>
</h3>
<p>The package constructs design matrices differently for prognostic and
predictive effects based on modeling goals:</p>
<ul>
<li>
<strong>Prognostic Effects (<code>X</code> matrix):</strong> Uses
standard <strong>dummy coding</strong> (dropping one reference level per
categorical variable). This avoids collinearity with the intercept and
yields interpretable main effect coefficients relative to a baseline
group.</li>
<li>
<strong>Predictive Effects (<code>Z</code> matrix):</strong> Uses
<strong>one-hot encoding</strong> (creating a binary indicator for
<em>every</em> level of each categorical variable, <em>without</em>
dropping a reference). This treats all subgroup levels symmetrically
under the shrinkage prior, reflecting an assumption of exchangeability
for the interaction effects.</li>
</ul>
</div>
<div class="section level3">
<h3 id="general-global-model">General Global Model<a class="anchor" aria-label="anchor" href="#general-global-model"></a>
</h3>
<p>The package primarily implements a global model structure <span class="citation">(Wolbers et al. 2025)</span> where all effects are
estimated simultaneously. The linear predictor,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ˆ</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>,
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
patients is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>ğ›ˆ</mi><mo>=</mo><msub><mi>ğ—</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><mo>+</mo><msub><mi>ğ—</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><mo>+</mo><msub><mi>ğ™</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><mo>+</mo><msub><mi>ğ™</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><mo>+</mo><mi>ğ”</mi><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub></mrow><annotation encoding="application/x-tex">
g(\boldsymbol{\mu}) = \boldsymbol{\eta} = \mathbf{X_p}\boldsymbol{\beta_{1,p}} + \mathbf{X_n}\boldsymbol{\beta_{1,n}} + \mathbf{Z_p}\boldsymbol{\beta_{2,p}} + \mathbf{Z_n}\boldsymbol{\beta_{2,n}} + \mathbf{U}\boldsymbol{\beta_{3}}
</annotation></semantics></math> Where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>â‹…</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>
is the link function.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math>
is the vector of expected outcomes.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ—</mi><mi>ğ§</mi></msub><annotation encoding="application/x-tex">\mathbf{X_n}</annotation></semantics></math>
contains columns for <strong>unshrunk prognostic</strong> effects
(intercept, main treatment effect, specified main effects) using dummy
coding.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,n}}</annotation></semantics></math>
are their coefficients.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ—</mi><mi>ğ©</mi></msub><annotation encoding="application/x-tex">\mathbf{X_p}</annotation></semantics></math>
contains columns for <strong>shrunk prognostic</strong> effects
(specified main effects) using dummy coding.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,p}}</annotation></semantics></math>
are their coefficients, assigned a shrinkage prior.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ™</mi><mi>ğ§</mi></msub><annotation encoding="application/x-tex">\mathbf{Z_n}</annotation></semantics></math>
contains columns for <strong>unshrunk predictive</strong> effects
(treatment interactions) using one-hot encoding.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,n}}</annotation></semantics></math>
are their coefficients.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ™</mi><mi>ğ©</mi></msub><annotation encoding="application/x-tex">\mathbf{Z_p}</annotation></semantics></math>
contains columns for <strong>shrunk predictive</strong> effects
(treatment interactions) using one-hot encoding.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,p}}</annotation></semantics></math>
are their coefficients, assigned a shrinkage prior.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ”</mi><annotation encoding="application/x-tex">\mathbf{U}</annotation></semantics></math>
contains columns for additional <strong>unshrunk prognostic</strong>
covariates.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{3}}</annotation></semantics></math>
are their coefficients.</li>
</ul>
<p>This structure allows flexible assignment of terms to shrunk or
unshrunk categories:</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="37%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left"><strong>Shrinkage Prior</strong></th>
<th align="left"><strong>Weakly Informative Prior</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Prognostic Effect</strong></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ—</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{X_p}\boldsymbol{\beta_{1,p}}</annotation></semantics></math></td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ—</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{X_n}\boldsymbol{\beta_{1,n}}</annotation></semantics></math>
+
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ”</mi><msub><mi>ğ›ƒ</mi><mn>ğŸ‘</mn></msub></mrow><annotation encoding="application/x-tex">\mathbf{U}\boldsymbol{\beta_{3}}</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td align="left"><strong>Predictive Effect</strong></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ™</mi><mi>ğ©</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{Z_p}\boldsymbol{\beta_{2,p}}</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ™</mi><mi>ğ§</mi></msub><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{Z_n}\boldsymbol{\beta_{2,n}}</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<p>The linear predictor for a single patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î·</mi><mi>i</mi></msub><mo>=</mo><munder><munder><mrow><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Î²</mi><mtext mathvariant="normal">treat</mtext></msub><msub><mi>s</mi><mi>i</mi></msub><mo>+</mo><mo>âˆ‘</mo><msup><mi>Î²</mi><mtext mathvariant="normal">prog, shrunk</mtext></msup><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mo>âˆ‘</mo><msup><mi>Î²</mi><mtext mathvariant="normal">prog, unshrunk</mtext></msup><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mo>âˆ‘</mo><msup><mi>Î²</mi><mtext mathvariant="normal">extra</mtext></msup><msub><mi>u</mi><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Prognostic Component</mtext></munder><mo>+</mo><munder><munder><mrow><mo>âˆ‘</mo><msup><mi>Î²</mi><mtext mathvariant="normal">pred, shrunk</mtext></msup><msub><mi>z</mi><mi>i</mi></msub><mo>+</mo><mo>âˆ‘</mo><msup><mi>Î²</mi><mtext mathvariant="normal">pred, unshrunk</mtext></msup><msub><mi>z</mi><mi>i</mi></msub></mrow><mo accent="true">âŸ</mo></munder><mtext mathvariant="normal">Predictive Component</mtext></munder></mrow><annotation encoding="application/x-tex">\eta_i = \underbrace{\beta_0 + \beta_{\text{treat}}s_i + \sum \beta^{\text{prog, shrunk}} x_i + \sum \beta^{\text{prog, unshrunk}} x_i + \sum \beta^{\text{extra}} u_i}_{\text{Prognostic Component}} + \underbrace{\sum \beta^{\text{pred, shrunk}} z_i + \sum \beta^{\text{pred, unshrunk}} z_i}_{\text{Predictive Component}}
</annotation></semantics></math><em>(Note: The indices and notation are
simplified here for clarity compared to the full matrix form).</em></p>
</div>
</div>
<div class="section level2">
<h2 id="endpoint-specific-models">Endpoint-Specific Models<a class="anchor" aria-label="anchor" href="#endpoint-specific-models"></a>
</h2>
<p>The package supports four endpoint types by selecting the appropriate
likelihood and link function within <code>brms</code>.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="21%">
<col width="30%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="left">Endpoint</th>
<th align="left">Distribution / Model</th>
<th align="left">Link Function</th>
<th align="left">Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Continuous</strong></td>
<td align="left">Normal:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>,</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim N(\mu_i, \sigma^2)</annotation></semantics></math>
</td>
<td align="left">Identity:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Î·</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mu_i = \eta_i</annotation></semantics></math>
</td>
<td align="left">Residual standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
can be stratified.</td>
</tr>
<tr class="even">
<td align="left"><strong>Binary</strong></td>
<td align="left">Bernoulli:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">Bernoulli</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim \text{Bernoulli}(p_i)</annotation></semantics></math>
</td>
<td align="left">Logit:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>p</mi><mi>i</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>p</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Î·</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\text{logit}(p_i) = \log\left(\frac{p_i}{1-p_i}\right) = \eta_i</annotation></semantics></math>
</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><strong>Count</strong></td>
<td align="left">Negative Binomial:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">NegBin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim \text{NegBin}(\mu_i, \phi)</annotation></semantics></math>
</td>
<td align="left">Log:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Î·</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\log(\mu_i) = \eta_i</annotation></semantics></math>
</td>
<td align="left">Overdispersion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
can be stratified.</td>
</tr>
<tr class="even">
<td align="left"><strong>Time-to-event</strong></td>
<td align="left">Cox Proportional Hazards:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î·</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_i(t) = h_0(t)\exp(\eta_i)</annotation></semantics></math>
</td>
<td align="left">Log (on the hazard)</td>
<td align="left">Intercept absorbed by baseline hazard
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_0(t)</annotation></semantics></math>,
modeled via <code>bhaz()</code> splines.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_0(t)</annotation></semantics></math>
can be stratified.</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="prior-specifications">Prior Specifications<a class="anchor" aria-label="anchor" href="#prior-specifications"></a>
</h2>
<p>Appropriate prior selection is crucial in Bayesian analysis,
especially when using shrinkage.</p>
<div class="section level3">
<h3 id="weakly-informative-priors">Weakly Informative Priors<a class="anchor" aria-label="anchor" href="#weakly-informative-priors"></a>
</h3>
<p>For parameters <em>not</em> subject to shrinkage (intercept, main
treatment effect, covariates in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ—</mi><mi>ğ§</mi></msub><annotation encoding="application/x-tex">\mathbf{X_n}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ™</mi><mi>ğ§</mi></msub><annotation encoding="application/x-tex">\mathbf{Z_n}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ”</mi><annotation encoding="application/x-tex">\mathbf{U}</annotation></semantics></math>),
<strong>weakly informative priors</strong> are used. These provide
minimal regularization, primarily to aid computation and prevent
unreasonable parameter estimates.</p>
<ul>
<li>
<strong>Default:</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>s</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(0, s^2)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
is large but sensible (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">s=10</annotation></semantics></math>
on the linear predictor scale). The <code>bonsaiforest2</code> package
uses <code>normal(0, 10)</code> as the default. Users can override
this.</li>
</ul>
</div>
<div class="section level3">
<h3 id="shrinkage-priors-for-penalized-terms-boldsymbolbeta_1p-boldsymbolbeta_2p">Shrinkage Priors for Penalized Terms
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><mo>,</mo><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\beta_{1,p}}, \boldsymbol{\beta_{2,p}}</annotation></semantics></math>)<a class="anchor" aria-label="anchor" href="#shrinkage-priors-for-penalized-terms-boldsymbolbeta_1p-boldsymbolbeta_2p"></a>
</h3>
<p>These priors pull coefficients towards a common center (usually
zero), effectively reducing noise and performing model selection.
<code>bonsaiforest2</code> facilitates the use of several
state-of-the-art shrinkage priors via <code>brms</code>.</p>
<p><em>Marginal density comparison of various shrinkage priors.
Reference: <span class="citation">Zhang et al. (2022)</span>.</em></p>
<div class="section level4">
<h4 id="regularized-horseshoe-prior">Regularized Horseshoe Prior<a class="anchor" aria-label="anchor" href="#regularized-horseshoe-prior"></a>
</h4>
<ul>
<li><p><strong>Concept:</strong> A highly effective global-local prior
with a sharp peak at zero (strong shrinkage for null effects) and heavy
tails (minimal shrinkage for large, true effects) <span class="citation">(Wolbers et al. 2025)</span>. The â€œregularizedâ€ version
adds slight penalization for very large effects.</p></li>
<li><p><strong>Specification:</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î²</mi><mi>l</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>Ï„</mi><mn>2</mn></msup><msubsup><mover><mi>Î»</mi><mo accent="true">Ìƒ</mo></mover><mi>l</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mover><mi>Î»</mi><mo accent="true">Ìƒ</mo></mover><mi>l</mi><mn>2</mn></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><msup><mi>c</mi><mn>2</mn></msup><msubsup><mi>Î»</mi><mi>l</mi><mn>2</mn></msubsup></mrow><mrow><msup><mi>c</mi><mn>2</mn></msup><mo>+</mo><msup><mi>Ï„</mi><mn>2</mn></msup><msubsup><mi>Î»</mi><mi>l</mi><mn>2</mn></msubsup></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î»</mi><mi>l</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><msup><mi>C</mi><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Local shrinkage</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï„</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><msup><mi>C</mi><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>Ï„</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Global shrinkage</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>c</mi><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Inverse-Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î½</mi><mi>/</mi><mn>2</mn><mo>,</mo><mi>Î½</mi><msup><mi>s</mi><mn>2</mn></msup><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Regularization</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\beta_{l} &amp;\sim N(0, \tau^2 \tilde{\lambda}_l^2) \\
\tilde{\lambda}_l^2 &amp;= \frac{c^2 \lambda_l^2}{c^2 + \tau^2 \lambda_l^2} \\
\lambda_l &amp;\sim C^+(0, 1) \quad (\text{Local shrinkage}) \\
\tau &amp;\sim C^+(0, \tau_0) \quad (\text{Global shrinkage}) \\
c^2 &amp;\sim \text{Inverse-Gamma}(\nu/2, \nu s^2/2) \quad (\text{Regularization})
\end{aligned}
</annotation></semantics></math></p></li>
<li>
<p><strong>Hyperparameter Justification:</strong> The global scale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\tau_0</annotation></semantics></math>
is key. <code>brms</code> (and <code>bonsaiforest2</code>) allows
specification via <code><a href="https://paulbuerkner.com/brms/reference/horseshoe.html" class="external-link">horseshoe()</a></code> arguments:</p>
<ul>
<li>
<code>scale_global</code>: Directly sets
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\tau_0</annotation></semantics></math>.
A common default is <code>scale_global = 1</code>.</li>
<li>
<code>par_ratio</code>: Sets
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï„</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\tau_0</annotation></semantics></math>
based on the expected proportion of non-zero coefficients
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><annotation encoding="application/x-tex">p_{eff}</annotation></semantics></math>)
out of the total
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>),
using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï„</mi><mn>0</mn></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo>âˆ’</mo><msub><mi>p</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msqrt><mi>N</mi></msqrt></mrow><annotation encoding="application/x-tex">\tau_0 = (p_{eff}/(L-p_{eff})) / \sqrt{N}</annotation></semantics></math><span class="citation">(Piironen and Vehtari 2017; Bornkamp
2025)</span>. This allows tailoring shrinkage based on prior belief
about heterogeneity.</li>
</ul>
</li>
<li><p><strong>Package Default:</strong> The default shrinkage prior in
<code>bonsaiforest2</code> is <code>horseshoe(scale_global = 1)</code>,
following <span class="citation">Wolbers et al. (2025)</span>. Users can
specify alternatives (e.g., using <code>par_ratio</code>).</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="r2d2-prior">R2D2 Prior<a class="anchor" aria-label="anchor" href="#r2d2-prior"></a>
</h4>
<ul>
<li>
<strong>Concept:</strong> Places a prior on the proportion of
variance explained
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>)
by the shrunk coefficients, then allocates this variance using a
Dirichlet distribution, which controls sparsity <span class="citation">(Zhang et al. 2022; Bornkamp 2025)</span>.</li>
<li>
<strong>Specification (Simplified):</strong> Coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mi>l</mi></msub><annotation encoding="application/x-tex">\beta_l</annotation></semantics></math>
follow a distribution related to Double-Exponential (Laplace), where the
individual variances depend on a global variance term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï‰</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>
(related to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
via a Beta-Prime or Beta distribution) and local allocation parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\phi}</annotation></semantics></math>
(from a Dirichlet distribution).</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î²</mi><mi>l</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Kernel</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ïƒ</mi><mo>,</mo><msub><mi>Ï•</mi><mi>l</mi></msub><mo>,</mo><mi>Ï‰</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>ğ›Ÿ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Dirichlet</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>Ï€</mi></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>a</mi><mi>Ï€</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï‰</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mtext mathvariant="normal">Beta-Prime</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mo>â‡”</mo><msup><mi>R</mi><mn>2</mn></msup><mo>=</mo><mfrac><mi>Ï‰</mi><mrow><mn>1</mn><mo>+</mo><mi>Ï‰</mi></mrow></mfrac><mo>âˆ¼</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
    \beta_{l} &amp;\sim \text{Kernel}(\sigma, \phi_l, \omega) \\
    \boldsymbol{\phi} &amp;\sim \text{Dirichlet}(a_\pi, \dots, a_\pi) \\
    \omega &amp;\sim \text{Beta-Prime}(a, b) \quad (\iff R^2 = \frac{\omega}{1+\omega} \sim \text{Beta}(a,b))
    \end{aligned}
    </annotation></semantics></math> - <strong>Hyperparameter
Justification:</strong> Following <span class="citation">Zhang et al.
(2022)</span>: - Set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">b=0.5</annotation></semantics></math>
for heavy tails (recommended default). - The Dirichlet concentration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>
controls sparsity: smaller
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>
(e.g., 0.2) implies higher shrinkage (more sparsity); larger
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>
(e.g., 0.5 or 1.0) implies lower shrinkage. - <strong>Package
Implementation:</strong> Users can specify the R2D2 prior by providing
the string <code>"R2D2(mean_R2=..., prec_R2=..., cons_D=...)"</code> to
the prior arguments, where <code>cons_D</code> corresponds to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>Ï€</mi></msub><annotation encoding="application/x-tex">a_\pi</annotation></semantics></math>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="estimation-and-inference-procedure">Estimation and Inference Procedure<a class="anchor" aria-label="anchor" href="#estimation-and-inference-procedure"></a>
</h2>
<div class="section level3">
<h3 id="posterior-sampling-mcmc">Posterior Sampling: MCMC<a class="anchor" aria-label="anchor" href="#posterior-sampling-mcmc"></a>
</h3>
<p>Models are fitted using Hamiltonian Monte Carlo (HMC) via Stan, as
implemented in <code>brms</code>. This generates samples from the joint
posterior distribution of all model parameters.</p>
</div>
<div class="section level3">
<h3 id="deriving-subgroup-treatment-effects">Deriving Subgroup Treatment Effects<a class="anchor" aria-label="anchor" href="#deriving-subgroup-treatment-effects"></a>
</h3>
<p>For the global model, the treatment effect for subgroup level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
on the linear predictor scale is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>l</mi></msub><mo>=</mo><msub><mi>Î²</mi><mtext mathvariant="normal">treat</mtext></msub><mo>+</mo><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\theta_l = \beta_{\text{treat}} + \beta_{2,l}</annotation></semantics></math>
(where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mrow><mn>2</mn><mo>,</mo><mi>l</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{2,l}</annotation></semantics></math>
is the corresponding interaction coefficient from either
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ©</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,p}}</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›ƒ</mi><mrow><mn>ğŸ</mn><mo mathvariant="bold">,</mo><mi>ğ§</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\beta_{2,n}}</annotation></semantics></math>).
This sum is computed for each MCMC draw to obtain the posterior
distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¸</mi><mi>l</mi></msub><annotation encoding="application/x-tex">\theta_l</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="standardization-for-marginal-effects-g-computation">Standardization for Marginal Effects (G-computation)<a class="anchor" aria-label="anchor" href="#standardization-for-marginal-effects-g-computation"></a>
</h3>
<p>Model coefficients typically represent <em>conditional</em> effects.
To obtain <em>marginal</em> effects (average treatment effect within a
subgroup, averaged over other covariates), the package uses
G-computation implemented via posterior predictions.</p>
<p><strong>Process per MCMC draw:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Create Counterfactuals:</strong> For each subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
predict their outcome under treatment
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s_i=1</annotation></semantics></math>)
and control
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s_i=0</annotation></semantics></math>),
keeping all other covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_i, x_i</annotation></semantics></math>
as observed.</li>
<li>
<strong>Predict Outcomes:</strong> Use the parameter values from the
current MCMC draw to calculate the predicted outcome (e.g., probability,
rate, mean, survival curve) for each subject under both scenarios.</li>
<li>
<strong>Average within Subgroups:</strong> For a specific subgroup
level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>,
calculate the average predicted outcome under treatment
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mtext mathvariant="normal">treat</mtext></mrow></msub><annotation encoding="application/x-tex">\hat{\mu}_{l, \text{treat}}</annotation></semantics></math>)
and control
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mtext mathvariant="normal">cont</mtext></mrow></msub><annotation encoding="application/x-tex">\hat{\mu}_{l, \text{cont}}</annotation></semantics></math>)
<em>only among subjects belonging to subgroup</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>.</li>
<li>
<strong>Calculate Effect Measure:</strong> Compute the desired
marginal effect based on the response type (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mtext mathvariant="normal">treat</mtext></mrow></msub><mo>âˆ’</mo><msub><mover><mi>Î¼</mi><mo accent="true">Ì‚</mo></mover><mrow><mi>l</mi><mo>,</mo><mtext mathvariant="normal">cont</mtext></mrow></msub></mrow><annotation encoding="application/x-tex">\hat{\mu}_{l, \text{treat}} - \hat{\mu}_{l, \text{cont}}</annotation></semantics></math>
for continuous; Odds Ratio for binary; Rate Ratio for count; Average
Hazard Ratio for survival). This yields one draw from the posterior of
the marginal effect for subgroup
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>.</li>
<li>
<strong>Repeat:</strong> Repeat for all MCMC draws to get the full
posterior distribution for each subgroupâ€™s marginal effect. Summaries
(median, CrI) are then calculated from these distributions.</li>
</ol>
<p>This standardization ensures that subgroup comparisons are made on a
comparable, marginal scale, accounting for differing covariate
distributions across subgroups.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bornkamp2025benchmarking" class="csl-entry">
Bornkamp, BjÃ¶rn. 2025. <span>â€œ<span class="nocase">Benchmarking Bayesian
subgroup shrinkage methods on clinical data</span>.â€</span> In <em>PSI
Conference 2025</em>. London, UK.
</div>
<div id="ref-piironen2017sparsity" class="csl-entry">
Piironen, J., and A. Vehtari. 2017. <span>â€œ<span class="nocase">Sparsity
information and regularization in the horseshoe and other shrinkage
priors</span>.â€</span> <em>Electronic Journal of Statistics</em> 11:
5018â€“51.
</div>
<div id="ref-wolbers2025using" class="csl-entry">
Wolbers, Marcel, Mar VÃ¡zquez RabuÃ±al, Ke Li, Kaspar Rufibach, and Daniel
SabanÃ©s BovÃ©. 2025. <span>â€œ<span class="nocase">Using shrinkage methods
to estimate treatment effects in overlapping subgroups in randomized
clinical trials with a time-to-event endpoint</span>.â€</span>
<em>Statistical Methods in Medical Research</em>, 1â€“12.
</div>
<div id="ref-zhang2022bayesian" class="csl-entry">
Zhang, Yan Dora, Brian P. Naughton, Howard D. Bondell, and Brian J.
Reich. 2022. <span>â€œ<span class="nocase">Bayesian regression using a
prior on the model fit: The R2-D2 shrinkage prior</span>.â€</span>
<em>Journal of the American Statistical Association</em> 117 (538):
862â€“74.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miriam Pedrera Gomez, Isaac Gravestock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
