<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using bonsai forest for Bayesian Subgroup Analysis â€¢ bonsaiforest2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using bonsai forest for Bayesian Subgroup Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bonsaiforest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/Statistical_Specifications.html">Statistical Specifications</a></li>
    <li><a class="dropdown-item" href="../articles/technical-details.html">Technical Details of bonsai forest Models</a></li>
    <li><a class="dropdown-item" href="../articles/using-bonsaiforest.html">Using bonsai forest for Bayesian Subgroup Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using bonsai forest for Bayesian Subgroup Analysis</h1>
            
      

      <div class="d-none name"><code>using-bonsaiforest.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Welcome to the <code>bonsaiforest2</code> package! ðŸŒ³ Its main goal
is to make it easier to fit and interpret <strong>Bayesian models for
subgroup analysis</strong> in clinical trials using the powerful
<code>brms</code> package in the background.</p>
<p><code>bonsaiforest2</code> helps you:</p>
<ul>
<li>Distinguish between <strong>prognostic</strong> (baseline outcome
predictors) and <strong>predictive</strong> (treatment effect modifiers)
variables.</li>
<li>Apply different <strong>shrinkage priors</strong> to different sets
of coefficients, allowing for robust exploration of subgroup effects
while controlling for false positives.</li>
<li>Calculate interpretable <strong>marginal treatment effects</strong>
for each subgroup.</li>
<li>
<strong>Visualize</strong> the results using forest plots.</li>
</ul>
<p>This vignette will guide you through the <strong>main
workflow</strong> using the primary functions:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/run_brms_analysis.html">run_brms_analysis()</a></code>: Prepares the model formula and
fits the <code>brms</code> model.</li>
<li>
<code><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects()</a></code>: Calculates the marginal
overall and subgroup treatment effects from the fitted model.</li>
<li>
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>: Creates a forest plot from the summary
object.</li>
</ol>
<p>Letâ€™s get started!</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, letâ€™s load the necessary packages. Make sure you have
<code>bonsaiforest2</code>, <code>brms</code>, <code>survival</code>,
<code>dplyr</code>, and <code>ggplot2</code> installed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the main package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/bonsaiforest2/">bonsaiforest2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load other required packages for examples</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Rcpp</span></span>
<span><span class="co">#&gt; Loading 'brms' package (version 2.23.0). Useful instructions</span></span>
<span><span class="co">#&gt; can be found by typing help('brms'). A more detailed introduction</span></span>
<span><span class="co">#&gt; to the package is available through vignette('brms_overview').</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'brms'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ar</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'survival'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:brms':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     kidney</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="core-workflow-functions">Core Workflow Functions<a class="anchor" aria-label="anchor" href="#core-workflow-functions"></a>
</h2>
<p>The package follows a simple workflow: <strong>Specify &amp; Fit
-&gt; Summarize -&gt; Plot</strong>.</p>
<div class="section level3">
<h3 id="run_brms_analysis">1. <code>run_brms_analysis()</code><a class="anchor" aria-label="anchor" href="#run_brms_analysis"></a>
</h3>
<p>This is your main workhorse function for setting up and fitting the
model. You provide your data and define different parts of the model
using formula strings.</p>
<p><strong>Key Arguments:</strong></p>
<ul>
<li>
<code>data</code>: Your input <code>data.frame</code>.</li>
<li>
<code>response_formula_str</code>: Defines the outcome and main
treatment effect (e.g., <code>"outcome ~ trt"</code>).</li>
<li>
<code>response_type</code>: <code>"continuous"</code>,
<code>"binary"</code>, <code>"count"</code>, or
<code>"survival"</code>.</li>
<li>
<code>unshrunk_prognostic_formula_str</code>: Main effects (not
treatment interactions) to estimate without strong shrinkage (e.g.,
<code>"~ age"</code>).</li>
<li>
<code>shrunk_prognostic_formula_str</code>: Main effects to estimate
with shrinkage.</li>
<li>
<code>unshrunk_predictive_formula_str</code>: Treatment interactions
to estimate without strong shrinkage (e.g.,
<code>"~ prespecified_marker:trt"</code>).</li>
<li>
<code>shrunk_predictive_formula_str</code>: Treatment interactions
to estimate with shrinkage (e.g.,
<code>"~ region:trt + sex:trt"</code>). Often used for exploratory
subgroups.</li>
<li>
<code>prognostic_effect_priors</code>,
<code>predictive_effect_priors</code>: Lists specifying priors for
shrunk/unshrunk terms (see next section).</li>
<li>
<code>stanvars</code>: Optional object from
<code><a href="https://paulbuerkner.com/brms/reference/stanvar.html" class="external-link">brms::stanvar()</a></code> for custom Stan code (e.g., for
hierarchical priors).</li>
<li>
<code>...</code>: Other arguments passed directly to
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> (like <code>chains</code>, <code>iter</code>,
<code>cores</code>).</li>
</ul>
<p>This function internally calls <code>prepare_formula_model</code> to
build the complex <code>brmsformula</code> and process the data (like
creating dummy variables for interactions) and then calls
<code>fit_brms_model</code> to run the MCMC sampling.</p>
</div>
<div class="section level3">
<h3 id="summary_subgroup_effects">2. <code>summary_subgroup_effects()</code><a class="anchor" aria-label="anchor" href="#summary_subgroup_effects"></a>
</h3>
<p>Once you have a fitted model from <code>run_brms_analysis</code>,
this function calculates the key results: <strong>marginal subgroup
treatment effects</strong>.</p>
<p><strong>Key Arguments:</strong></p>
<ul>
<li>
<code>brms_fit</code>: The fitted model object from
<code>run_brms_analysis</code>.</li>
<li>
<code>original_data</code>: The <em>original</em>
<code>data.frame</code> you passed to <code>run_brms_analysis</code>.
This is crucial for correctly identifying subgroup levels.</li>
<li>
<code>trt_var</code>: The name of the treatment variable
(string).</li>
<li>
<code>subgroup_vars</code>: Which subgroups to analyze. Can be:
<ul>
<li>
<code>"auto"</code> (default): Automatically finds subgroups based
on interaction terms in the model.</li>
<li>
<code>NULL</code>: Calculates only the overall marginal effect.</li>
<li>A character vector (e.g., <code>c("region", "sex")</code>):
Calculates effects for the specified variables.</li>
</ul>
</li>
<li>
<code>response_type</code>: Must match the type used for
fitting.</li>
</ul>
<p>This function uses a <strong>counterfactual approach
(G-computation)</strong> to estimate average effects for each subgroup,
integrating over the distribution of other covariates within that
subgroup. It returns a special <code>subgroup_summary</code> object.</p>
</div>
<div class="section level3">
<h3 id="plot">3. <code>plot()</code><a class="anchor" aria-label="anchor" href="#plot"></a>
</h3>
<p>This function takes the <code>subgroup_summary</code> object and
generates a forest plot.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assuming 'my_summary' is output from summary_subgroup_effects()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_summary</span>, title <span class="op">=</span> <span class="st">"My Forest Plot"</span>, x_lab <span class="op">=</span> <span class="st">"Effect Measure (e.g., AHR)"</span><span class="op">)</span></span></code></pre></div>
<p>It automatically arranges the subgroups, adds reference lines, and
formats the estimates with credible intervals.</p>
</div>
</div>
<div class="section level2">
<h2 id="specifying-priors">Specifying Priors<a class="anchor" aria-label="anchor" href="#specifying-priors"></a>
</h2>
<p>You can control the priors used for the different model components
via the <code>prognostic_effect_priors</code> and
<code>predictive_effect_priors</code> arguments in
<code>fit_brms_model</code>.</p>
<ul>
<li>
<code>predictive_effect_priors</code> expects a named list like
<code>list(shrunk = ..., unshrunk = ...)</code>.</li>
<li>
<code>prognostic_effect_priors</code> expects a named list like
<code>list(shrunk = ..., unshrunk = ..., intercept = ...)</code>.</li>
</ul>
<div class="section level3">
<h3 id="prior-formats">Prior Formats<a class="anchor" aria-label="anchor" href="#prior-formats"></a>
</h3>
<p>You can provide priors in several formats:</p>
<ul>
<li>
<strong><code>NULL</code> (Default):</strong> If you provide
<code>NULL</code> or omit an argument, the functionâ€™s built-in defaults
are used.</li>
<li>
<strong>Simple Strings:</strong> You can provide standard
<code>brms</code> prior strings (e.g.,
<code>"normal(0, 1)"</code>).</li>
<li>
<strong>Advanced Priors:</strong> You can use strings for advanced
priors like <code>"R2D2(mean_R2 = 0.5, prec_R2 = 1)"</code> or provide
full <code>brmsprior</code> objects (e.g., for custom hierarchical
structures using <code>stanvars</code>).</li>
</ul>
</div>
<div class="section level3">
<h3 id="default-priors">Default Priors<a class="anchor" aria-label="anchor" href="#default-priors"></a>
</h3>
<p>If priors are not specified, the function applies the following
defaults (as defined in the <code>fit_brms_model</code> code):</p>
<ul>
<li>
<strong>Prognostic Shrunk:</strong> <code>horseshoe(1)</code>
</li>
<li>
<strong>Prognostic Unshrunk:</strong> <code>normal(0, 5)</code>
</li>
<li>
<strong>Prognostic Intercept:</strong>
<code>normal(0, 10)</code>
</li>
<li>
<strong>Predictive Shrunk:</strong> <code>horseshoe(1)</code>
</li>
<li>
<strong>Predictive Unshrunk:</strong> <code>normal(0, 5)</code>
</li>
</ul>
<p><strong>Note:</strong> The intercept prior is <em>not</em> applied
for <code>response_type = "survival"</code>, as Cox models do not have a
global intercept.</p>
</div>
<div class="section level3">
<h3 id="prior-recommendations-for-non-shrunk-terms">Prior Recommendations for non-shrunk terms<a class="anchor" aria-label="anchor" href="#prior-recommendations-for-non-shrunk-terms"></a>
</h3>
<p>While the defaults are sensible, for continuous outcomes, we
recommend setting weakly informative priors scaled to your data. A
common approach is to base priors on the standard deviation (SD) of the
outcome variable.</p>
<p>For example, if you pre-calculate
<code>my_sd &lt;- sd(my_data$outcome)</code>:</p>
<ul>
<li>
<strong>Prognostic Intercept:</strong> We recommend a wide prior,
such as <code>normal(0, 10 * my_sd)</code>.</li>
<li>
<strong>Prognostic Unshrunk:</strong> We recommend a prior scaled to
the outcome, such as <code>normal(0, my_sd)</code>.</li>
</ul>
<p>You can implement this as shown in <strong>Example 3</strong>
below.</p>
<p>For a detailed explanation of shrinkage priors (Horseshoe, R2D2), see
the â€˜Technical Detailsâ€™ vignette
(<code><a href="../articles/technical-details.html">vignette('technical-details', package = 'bonsaiforest2')</a></code>).</p>
<p>Here are some examples of how to set priors:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assume 'prep_model' is a list object returned from prepare_formula_model()</span></span>
<span><span class="co"># It contains prep_model$formula, prep_model$data, and prep_model$response_type</span></span>
<span></span>
<span><span class="co"># Example 1: Use default priors</span></span>
<span><span class="co"># (horseshoe for shrunk, normal(0, 5)/normal(0, 10) for unshrunk)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_brms_model.html">fit_brms_model</a></span><span class="op">(</span></span>
<span>  prepared_model <span class="op">=</span> <span class="va">prep_model</span>, <span class="va">...</span>,</span>
<span>  predictive_effect_priors <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Or omit</span></span>
<span>  prognostic_effect_priors <span class="op">=</span> <span class="cn">NULL</span>  <span class="co"># Or omit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 2: Specify all priors using strings</span></span>
<span><span class="co"># This example clearly shows the 'intercept' argument</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_brms_model.html">fit_brms_model</a></span><span class="op">(</span></span>
<span>  prepared_model <span class="op">=</span> <span class="va">prep_model</span>, <span class="va">...</span>,</span>
<span>  predictive_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    shrunk <span class="op">=</span> <span class="st">"student_t(3, 0, 2.5)"</span>,</span>
<span>    unshrunk <span class="op">=</span> <span class="st">"normal(0, 5)"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  prognostic_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    shrunk <span class="op">=</span> <span class="st">"lasso(1)"</span>,</span>
<span>    unshrunk <span class="op">=</span> <span class="st">"normal(0, 10)"</span>,</span>
<span>    intercept <span class="op">=</span> <span class="st">"student_t(3, 0, 10)"</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 3: Use recommended weakly informative priors (e.g., for continuous outcome)</span></span>
<span><span class="co"># 1. Pre-calculate the standard deviation of the outcome from the prepared data</span></span>
<span><span class="co">#    (Assuming the outcome variable column is named 'my_outcome_variable')</span></span>
<span><span class="va">my_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">prep_model</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">my_outcome_variable</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># 2. Create prior strings based on the SD</span></span>
<span><span class="va">intercept_prior_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"normal(0, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">my_sd</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">unshrunk_prior_str</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"normal(0, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">my_sd</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Pass these strings to the function</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_brms_model.html">fit_brms_model</a></span><span class="op">(</span></span>
<span>  prepared_model <span class="op">=</span> <span class="va">prep_model</span>, <span class="va">...</span>,</span>
<span>  prognostic_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    shrunk <span class="op">=</span> <span class="st">"horseshoe(1)"</span>,       <span class="co"># Keep shrinkage prior</span></span>
<span>    unshrunk <span class="op">=</span> <span class="va">unshrunk_prior_str</span>,    <span class="co"># Use scaled prior</span></span>
<span>    intercept <span class="op">=</span> <span class="va">intercept_prior_str</span>   <span class="co"># Use wide, scaled prior</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># predictive_effect_priors will use defaults</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Example 4: Use R2D2 prior for shrunk predictive effects</span></span>
<span><span class="va">r2d2_prior_string</span> <span class="op">&lt;-</span> <span class="st">"R2D2(mean_R2 = 0.5, prec_R2 = 1)"</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_brms_model.html">fit_brms_model</a></span><span class="op">(</span></span>
<span>  prepared_model <span class="op">=</span> <span class="va">prep_model</span>, <span class="va">...</span>,</span>
<span>  predictive_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shrunk <span class="op">=</span> <span class="va">r2d2_prior_string</span><span class="op">)</span></span>
<span>  <span class="co"># prognostic_effect_priors and unshrunk predictive will use defaults</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 5: Custom hierarchical prior using stanvars</span></span>
<span><span class="co"># This is an advanced use case for defining a new hyperparameter 'tau_pred'</span></span>
<span><span class="co"># and setting a prior on it, which is then shared by the shrunk predictive effects.</span></span>
<span></span>
<span><span class="co"># 1. Define the hyperparameter 'tau_pred' for the Stan code</span></span>
<span><span class="va">stanvars_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/stanvar.html" class="external-link">stanvar</a></span><span class="op">(</span>scode <span class="op">=</span> <span class="st">"  real&lt;lower=0&gt; tau_pred;"</span>, block <span class="op">=</span> <span class="st">"parameters"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define the prior object using Stan code snippets</span></span>
<span><span class="co">#    - Places a normal(0, tau_pred) prior on the b_shpredeffect vector</span></span>
<span><span class="co">#    - Places a half-normal(0, 1) prior on tau_pred itself</span></span>
<span><span class="va">hierarchical_prior_pred</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://paulbuerkner.com/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"target += normal_lpdf(b_shpredeffect | 0, tau_pred)"</span>, check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paulbuerkner.com/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"target += normal_lpdf(tau_pred | 0, 1) - normal_lccdf(0 | 0, 1);"</span>, check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Pass both objects to the function</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_brms_model.html">fit_brms_model</a></span><span class="op">(</span></span>
<span>  prepared_model <span class="op">=</span> <span class="va">prep_model</span>, <span class="va">...</span>,</span>
<span>  predictive_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shrunk <span class="op">=</span> <span class="va">hierarchical_prior_pred</span><span class="op">)</span>,</span>
<span>  stanvars <span class="op">=</span> <span class="va">stanvars_pred</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="practical-examples">Practical Examples<a class="anchor" aria-label="anchor" href="#practical-examples"></a>
</h2>
<p>Letâ€™s walk through some examples using simulated data. <em>(Note:
<code>iter</code> is kept low for speed; use more iterations for real
analyses!)</em></p>
<div class="section level3">
<h3 id="example-1-continuous-outcome-blood-pressure">Example 1: Continuous Outcome (Blood Pressure)<a class="anchor" aria-label="anchor" href="#example-1-continuous-outcome-blood-pressure"></a>
</h3>
<p><em>Scenario</em>: Modeling change in Systolic Blood Pressure (SBP).
Adjust for <code>baseline_sbp</code> (unshrunk) and explore interactions
with <code>region</code> and <code>comorbidity</code> (shrunk).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">continuous_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_patients</span>,</span>
<span>  sbp_change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  baseline_sbp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, mean <span class="op">=</span> <span class="fl">140</span>, sd <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>  region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"EU"</span>, <span class="st">"APAC"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  comorbidity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Yes"</span>, <span class="st">"No"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Ensure trt is a factor before passing to run_brms_analysis</span></span>
<span><span class="va">continuous_data</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">continuous_data</span><span class="op">$</span><span class="va">trt</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">continuous_model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">continuous_data</span>,</span>
<span>  response_formula_str <span class="op">=</span> <span class="st">"sbp_change ~ trt"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  unshrunk_prognostic_formula_str <span class="op">=</span> <span class="st">"~ baseline_sbp"</span>,</span>
<span>  <span class="co"># Shrink intercept (1), region interaction, and comorbidity interaction</span></span>
<span>  shrunk_predictive_formula_str <span class="op">=</span> <span class="st">"~ 1 + region:trt + comorbidity:trt"</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">200</span>, warmup <span class="op">=</span> <span class="fl">100</span>, cores <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Minimal settings for vignette</span></span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span> <span class="co"># Use cmdstanr if available</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># print(continuous_model_fit) # Optional: view raw brms fit</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">continuous_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">continuous_model_fit</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">continuous_data</span>, <span class="co"># Pass the original data</span></span>
<span>  trt_var <span class="op">=</span> <span class="st">"trt"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"continuous"</span> <span class="co"># Must match fitting</span></span>
<span>  <span class="co"># subgroup_vars = "auto" is the default</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the summary table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">continuous_summary</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate and display the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">continuous_summary</span>, title <span class="op">=</span> <span class="st">"Continuous: Subgroup Effects on SBP Change"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-binary-outcome-patient-remission">Example 2: Binary Outcome (Patient Remission)<a class="anchor" aria-label="anchor" href="#example-2-binary-outcome-patient-remission"></a>
</h3>
<p><em>Scenario</em>: Modeling remission (0/1). Pre-specified
interaction with <code>genetic_marker</code> (unshrunk), adjust for
<code>age</code> and <code>disease_duration</code> (shrunk).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">binary_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  remission <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  therapy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  genetic_marker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Positive"</span>, <span class="st">"Negative"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">55</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  disease_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">binary_data</span><span class="op">$</span><span class="va">therapy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">binary_data</span><span class="op">$</span><span class="va">therapy</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">binary_data</span>,</span>
<span>  response_formula_str <span class="op">=</span> <span class="st">"remission ~ therapy"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  shrunk_prognostic_formula_str <span class="op">=</span> <span class="st">"~ age + disease_duration"</span>,</span>
<span>  unshrunk_predictive_formula_str <span class="op">=</span> <span class="st">"~ genetic_marker:therapy"</span>, <span class="co"># Focus interaction</span></span>
<span>  <span class="co"># Specify priors: horseshoe for shrunk prog, student_t for unshrunk pred</span></span>
<span>  prognostic_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shrunk <span class="op">=</span> <span class="st">"horseshoe(1)"</span><span class="op">)</span>,</span>
<span>  predictive_effect_priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>unshrunk <span class="op">=</span> <span class="st">"student_t(3, 0, 2.5)"</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">200</span>, warmup <span class="op">=</span> <span class="fl">100</span>, cores <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">0</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">binary_model_fit</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">binary_data</span>,</span>
<span>  trt_var <span class="op">=</span> <span class="st">"therapy"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"binary"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">binary_summary</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">binary_summary</span>, title <span class="op">=</span> <span class="st">"Binary: Subgroup Effects on Remission"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-count-outcome-disease-exacerbations">Example 3: Count Outcome (Disease Exacerbations)<a class="anchor" aria-label="anchor" href="#example-3-count-outcome-disease-exacerbations"></a>
</h3>
<p><em>Scenario</em>: Modeling exacerbation counts. Adjust for
<code>baseline_severity</code> (unshrunk) and many exploratory
<code>biomarkers</code> (shrunk). No interaction terms.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">biomarker_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">biomarker_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"biomarker_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  exacerbation_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span><span class="va">n_patients</span>, size <span class="op">=</span> <span class="fl">1.5</span>, mu <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  medication <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  baseline_severity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  log_exposure_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># Example offset</span></span>
<span><span class="op">)</span></span>
<span><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">count_data</span>, <span class="va">biomarker_data</span><span class="op">)</span></span>
<span><span class="va">count_data</span><span class="op">$</span><span class="va">medication</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">count_data</span><span class="op">$</span><span class="va">medication</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create formula string for all biomarkers</span></span>
<span><span class="va">shrunk_prog_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">biomarker_data</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">count_data</span>,</span>
<span>  <span class="co"># Include offset in response formula</span></span>
<span>  response_formula_str <span class="op">=</span> <span class="st">"exacerbation_count + offset(log_exposure_time) ~ medication"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>  unshrunk_prognostic_formula_str <span class="op">=</span> <span class="st">"~ 1 + baseline_severity"</span>, <span class="co"># Intercept included here</span></span>
<span>  shrunk_prognostic_formula_str <span class="op">=</span> <span class="va">shrunk_prog_str</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">200</span>, warmup <span class="op">=</span> <span class="fl">100</span>, cores <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">0</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">count_model_fit</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">count_data</span>,</span>
<span>  trt_var <span class="op">=</span> <span class="st">"medication"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="co"># subgroup_vars = "auto" will correctly find no subgroups</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">count_summary</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span> <span class="co"># Should only show "Overall"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">count_summary</span>, title <span class="op">=</span> <span class="st">"Count: Overall Effect on Exacerbations"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-4-survival-outcome-time-to-event">Example 4: Survival Outcome (Time-to-Event)<a class="anchor" aria-label="anchor" href="#example-4-survival-outcome-time-to-event"></a>
</h3>
<p><em>Scenario</em>: Oncology trial modeling time-to-event. Explore
interaction with <code>ecog_status</code> using shrinkage.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">250</span></span>
<span><span class="va">survival_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  survival_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n_patients</span>, rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  event_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>  cancer_drug <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  ecog_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># ECOG 0, 1, 2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">survival_data</span><span class="op">$</span><span class="va">cancer_drug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">survival_data</span><span class="op">$</span><span class="va">cancer_drug</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survival_model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">survival_data</span>,</span>
<span>  response_formula_str <span class="op">=</span> <span class="st">"Surv(survival_time, event_status) ~ cancer_drug"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  shrunk_predictive_formula_str <span class="op">=</span> <span class="st">"~ ecog_status:cancer_drug"</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">200</span>, warmup <span class="op">=</span> <span class="fl">100</span>, cores <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">0</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survival_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">survival_model_fit</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">survival_data</span>,</span>
<span>  trt_var <span class="op">=</span> <span class="st">"cancer_drug"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"survival"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">survival_summary</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">survival_summary</span>, title <span class="op">=</span> <span class="st">"Survival: Subgroup Effects (AHR)"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-5-stratified-continuous-model">Example 5: Stratified Continuous Model<a class="anchor" aria-label="anchor" href="#example-5-stratified-continuous-model"></a>
</h3>
<p><em>Scenario</em>: Modeling SBP change where variance differs by
<code>clinic_site</code>. We stratify <code>sigma</code>. Also explore
interaction with <code>age_group</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">180</span></span>
<span><span class="va">sigma_by_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>SiteA <span class="op">=</span> <span class="fl">6</span>, SiteB <span class="op">=</span> <span class="fl">12</span>, SiteC <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span><span class="va">sample_data_strat_cont</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_patients</span>,</span>
<span>    clinic_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SiteA"</span>, <span class="st">"SiteB"</span>, <span class="st">"SiteC"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">baseline_sbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, mean <span class="op">=</span> <span class="fl">145</span>, sd <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">age_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Under60"</span>, <span class="st">"Over60"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_by_site</span><span class="op">[</span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">clinic_site</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">sbp_change</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span> <span class="op">-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">8</span> <span class="op">-</span></span>
<span>                                     <span class="fl">0.2</span> <span class="op">*</span> <span class="op">(</span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">baseline_sbp</span> <span class="op">-</span> <span class="fl">145</span><span class="op">)</span> <span class="op">+</span></span>
<span>                                     <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sample_data_strat_cont</span><span class="op">$</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">"Over60"</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>                                     <span class="va">noise</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_continuous_stratified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_data_strat_cont</span>,</span>
<span>  response_formula_str <span class="op">=</span> <span class="st">"sbp_change ~ trt"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  unshrunk_prognostic_formula_str <span class="op">=</span> <span class="st">"~ baseline_sbp"</span>,</span>
<span>  shrunk_predictive_formula_str <span class="op">=</span> <span class="st">"~ age_group:trt"</span>,</span>
<span>  stratification_formula_str <span class="op">=</span> <span class="st">"~ clinic_site"</span>, <span class="co"># Stratify sigma by site</span></span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">200</span>, warmup <span class="op">=</span> <span class="fl">100</span>, cores <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">0</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_continuous_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">fit_continuous_stratified</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">sample_data_strat_cont</span>,</span>
<span>  trt_var <span class="op">=</span> <span class="st">"trt"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"continuous"</span> <span class="co"># Auto-detects age_group interaction</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">strat_continuous_summary</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">strat_continuous_summary</span>, title <span class="op">=</span> <span class="st">"Stratified Continuous: Subgroup Effects"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-6-stratified-survival-model">Example 6: Stratified Survival Model<a class="anchor" aria-label="anchor" href="#example-6-stratified-survival-model"></a>
</h3>
<p><em>Scenario</em>: Modeling time-to-event where baseline hazard
differs by <code>country</code>. We stratify the baseline hazard
(<code>bhaz</code>). Explore interaction with
<code>biomarker</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">lambda_by_country</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>US <span class="op">=</span> <span class="fl">0.01</span>, EU <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">surv_data_strat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_patients</span>,</span>
<span>    country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"EU"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, <span class="fl">65</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    biomarker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"High"</span><span class="op">)</span>, <span class="va">n_patients</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">-</span><span class="fl">0.6</span> <span class="op">+</span> <span class="op">(</span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">age</span> <span class="op">-</span> <span class="fl">65</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.03</span> <span class="op">+</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">biomarker</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">-</span><span class="fl">0.5</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_patients</span><span class="op">)</span></span>
<span><span class="va">lambda_vec</span> <span class="op">&lt;-</span> <span class="va">lambda_by_country</span><span class="op">[</span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">country</span><span class="op">]</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="co"># Weibull shape parameter</span></span>
<span><span class="va">true_event_time</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda_vec</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">gamma</span><span class="op">)</span></span>
<span><span class="va">censoring_time</span> <span class="op">&lt;-</span> <span class="fl">60</span> <span class="co"># Administrative censoring time</span></span>
<span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">event_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">true_event_time</span> <span class="op">&lt;=</span> <span class="va">censoring_time</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">surv_data_strat</span><span class="op">$</span><span class="va">event_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">true_event_time</span>, <span class="va">censoring_time</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_surv_stratified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">surv_data_strat</span>,</span>
<span>  response_formula_str <span class="op">=</span> <span class="st">"Surv(event_time, event_status) ~ trt"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  unshrunk_prognostic_formula_str <span class="op">=</span> <span class="st">"~ age"</span>,</span>
<span>  shrunk_predictive_formula_str <span class="op">=</span> <span class="st">"~ biomarker:trt"</span>,</span>
<span>  stratification_formula_str <span class="op">=</span> <span class="st">"~ country"</span>, <span class="co"># Stratify baseline hazard</span></span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">200</span>, warmup <span class="op">=</span> <span class="fl">100</span>, cores <span class="op">=</span> <span class="fl">1</span>, refresh <span class="op">=</span> <span class="fl">0</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_surv_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">fit_surv_stratified</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">surv_data_strat</span>,</span>
<span>  trt_var <span class="op">=</span> <span class="st">"trt"</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"survival"</span> <span class="co"># Auto-detects biomarker interaction</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">strat_surv_summary</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">strat_surv_summary</span>, title <span class="op">=</span> <span class="st">"Stratified Survival: Subgroup Effects (AHR)"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miriam Pedrera Gomez, Isaac Gravestock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
