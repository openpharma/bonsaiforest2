<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prepare a Multi-Part brms Formula and Corresponding Data — prepare_formula_model • bonsaiforest2</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare a Multi-Part brms Formula and Corresponding Data — prepare_formula_model"><meta name="description" content="This function serves as a pre-processor for building complex Bayesian
models with the brms package. It automates the construction of a multi-part,
non-linear formula by classifying covariates into three distinct categories:
unshrunk terms, shrunk prognostic, and shrunk predictive."><meta property="og:description" content="This function serves as a pre-processor for building complex Bayesian
models with the brms package. It automates the construction of a multi-part,
non-linear formula by classifying covariates into three distinct categories:
unshrunk terms, shrunk prognostic, and shrunk predictive."><meta property="og:image" content="https://openpharma.github.io/bonsaiforest2/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bonsaiforest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Advanced_Functionalities.html">Advanced Functionalities</a></li>
    <li><a class="dropdown-item" href="../articles/Quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/Statistical_Specifications.html">Statistical Specifications</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/bonsaiforest2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Prepare a Multi-Part brms Formula and Corresponding Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/bonsaiforest2/blob/main/R/prepare_formula_model.R" class="external-link"><code>R/prepare_formula_model.R</code></a></small>
      <div class="d-none name"><code>prepare_formula_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function serves as a pre-processor for building complex Bayesian
models with the <code>brms</code> package. It automates the construction of a multi-part,
non-linear formula by classifying covariates into three distinct categories:
unshrunk terms, shrunk prognostic, and shrunk predictive.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prepare_formula_model</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">response_formula</span>,</span>
<span>  unshrunk_terms_formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shrunk_prognostic_formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shrunk_predictive_formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  response_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binary"</span>, <span class="st">"count"</span>, <span class="st">"continuous"</span>, <span class="st">"survival"</span><span class="op">)</span>,</span>
<span>  stratification_formula <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame. Dataset containing all necessary variables for model fitting.
Must include the response variable, treatment variable, and all covariates specified
in the formula arguments. This data will be modified (contrast coding applied) and
returned for use in model fitting.</p></dd>


<dt id="arg-response-formula">response_formula<a class="anchor" aria-label="anchor" href="#arg-response-formula"></a></dt>
<dd><p>A formula object. The response specification defining the outcome
variable and treatment. Examples: <code>outcome ~ trt</code> for continuous outcomes,
<code>n_events + offset(log(days)) ~ trt</code> for count outcomes, or <code>Surv(time, status) ~ trt</code>
for survival models. The treatment variable (right-hand side) will be automatically
extracted and converted to a numeric binary variable (0/1).</p></dd>


<dt id="arg-unshrunk-terms-formula">unshrunk_terms_formula<a class="anchor" aria-label="anchor" href="#arg-unshrunk-terms-formula"></a></dt>
<dd><p>A formula object or <code>NULL</code>. Formula specifying unshrunk terms
for the <code>unshrunktermeffect</code> component. May include main effects and treatment interactions
without regularization. Supports three syntaxes that can be combined: colon notation
(e.g., <code>~ age + sex + trt:biomarker</code>), star notation (e.g., <code>~ age + trt*biomarker</code>),
or random effects notation (e.g., <code>~ age + (trt || biomarker)</code>).</p></dd>


<dt id="arg-shrunk-prognostic-formula">shrunk_prognostic_formula<a class="anchor" aria-label="anchor" href="#arg-shrunk-prognostic-formula"></a></dt>
<dd><p>A formula object or <code>NULL</code>. Formula specifying prognostic
main effects to be regularized in the <code>shprogeffect</code> component. These are covariates
where shrinkage/regularization is desired. Should use <code>~ 0 + ...</code> syntax to apply
one-hot encoding for symmetric regularization across all levels without privileging
a reference group.</p></dd>


<dt id="arg-shrunk-predictive-formula">shrunk_predictive_formula<a class="anchor" aria-label="anchor" href="#arg-shrunk-predictive-formula"></a></dt>
<dd><p>A formula object or <code>NULL</code>. Formula specifying predictive
terms (treatment interactions) to be regularized in the <code>shpredeffect</code> component.
Supports three syntaxes that can be combined: colon notation (e.g., <code>~ 0 + trt:region</code>),
star notation (e.g., <code>~ 0 + trt*region</code>), or random effects notation
(e.g., <code>~ (0 + trt || region)</code>). Should use <code>~ 0 + ...</code> syntax for one-hot encoding.</p></dd>


<dt id="arg-response-type">response_type<a class="anchor" aria-label="anchor" href="#arg-response-type"></a></dt>
<dd><p>A character string. Type of outcome variable, one of <code>"binary"</code>,
<code>"count"</code>, <code>"continuous"</code>, or <code>"survival"</code>. This determines the appropriate likelihood
function and link function for the model.</p></dd>


<dt id="arg-stratification-formula">stratification_formula<a class="anchor" aria-label="anchor" href="#arg-stratification-formula"></a></dt>
<dd><p>A formula object or <code>NULL</code>. Formula specifying stratification
variable (e.g., <code>~ strata_var</code>) for modeling baseline hazard (survival models) or
distributional parameters (other models). For survival models, estimates separate baseline
hazard functions (<code>bhaz</code>) for each stratum. For continuous models, models varying residual
standard deviation (<code>sigma</code>). For count models, models varying overdispersion (<code>shape</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>list</code> with six named elements:</p><dl><dt><code>formula</code></dt>
<dd><p><code>brmsformula</code> object containing the complete multi-part model specification</p></dd>

<dt><code>data</code></dt>
<dd><p><code>data.frame</code> with modified contrast coding (must be used for model fitting)</p></dd>

<dt><code>response_type</code></dt>
<dd><p><code>character(1)</code> indicating the outcome type (<code>"binary"</code>, <code>"count"</code>, <code>"continuous"</code>, or <code>"survival"</code>)</p></dd>

<dt><code>trt_var</code></dt>
<dd><p><code>character(1)</code> name of treatment variable extracted from response formula</p></dd>

<dt><code>stan_variable_names</code></dt>
<dd><p><code>list</code> of character vectors showing Stan parameter names for each model component</p></dd>

<dt><code>has_intercept</code></dt>
<dd><p><code>logical(1)</code> indicating whether the unshrunk formula includes an intercept (<code>TRUE</code>) or was specified with <code>~ 0 + ...</code> (<code>FALSE</code>)</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This classification allows for applying differential shrinkage (regularization)
to different parts of the model. The function also prepares the corresponding
data using R's contrast coding system for proper factor handling and interactions.</p>
    </div>
    <div class="section level2">
    <h2 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a></h2>


<ul><li><p><strong>Multi-Part Formula Construction:</strong> It generates a <code>brmsformula</code>
object with up to three distinct linear components (<code>unshrunktermeffect</code>,
<code>shprogeffect</code>, <code>shpredeffect</code>), which are combined in a non-linear model.
This allows for assigning different priors to each component.</p></li>
<li><p><strong>Automated Interaction Handling:</strong> Predictive terms support three syntaxes
that can be used together or separately: colon notation (e.g., <code>~ trt:subgroup</code>),
star notation (e.g., <code>~ trt*subgroup</code>), or random effects notation (e.g.,
<code>~ (trt || subgroup)</code>). You can mix these syntaxes in the same model (e.g.,
<code>~ trt:var1 + trt*var2 + (trt || var3)</code>). All variables involved in interactions
are converted to factors with appropriate contrasts (reference coding for unshrunk,
one-hot for shrunk), enabling proper model fitting and prediction on new data
without manual dummy variable creation.</p></li>
<li><p><strong>Hierarchical Integrity Check:</strong> When a predictive term like
<code>trt:subgroup</code> is specified, the function checks whether the corresponding
prognostic effect <code>subgroup</code> is included in the model. If missing, it issues
a warning message to alert you about the violation of the marginality
principle, allowing you to decide whether to add the main effect. Note: Star
notation (<code>*</code>) automatically includes main effects, so these variables are
excluded from the marginality check.</p></li>
<li><p><strong>Intelligent Defaults:</strong> The main treatment variable is automatically
added as an unshrunk prognostic term if not specified elsewhere. It also
provides warnings and resolves overlaps if a term is accidentally specified
in multiple categories.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="survival-model-details-robust-spline-knot-calculation-">Survival Model Details (Robust Spline Knot Calculation)<a class="anchor" aria-label="anchor" href="#survival-model-details-robust-spline-knot-calculation-"></a></h2>


<p>For survival models (<code>response_type = "survival"</code>), the function explicitly models
the baseline hazard using B-splines via <code>brms::bhaz()</code>. It implements a highly
robust method for calculating spline knots to ensure stability:</p><ol><li><p><strong>Boundary Definition:</strong> It first establishes boundary knots by taking
the range of unique event times and adding a small buffer. This creates a
"safe" interval for placing internal knots.</p></li>
<li><p><strong>Internal Knot Placement:</strong> It calculates internal knots using
quantiles of the event times that fall strictly within the boundary knots.
This prevents knots from being placed at the exact edges of the data, which
can cause numerical instability.</p></li>
<li><p><strong>Fallback for Sparse Data:</strong> If there are too few unique event
times to calculate quantile-based knots, it gracefully falls back to placing
evenly spaced knots within the defined boundaries.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="data-transformation-and-contrast-coding">Data Transformation and Contrast Coding<a class="anchor" aria-label="anchor" href="#data-transformation-and-contrast-coding"></a></h2>


<p>This function returns a modified <code>data.frame</code> that must be used in subsequent calls
to <code><a href="fit_brms_model.html">fit_brms_model()</a></code>, not the original data. The transformations are:</p><ul><li><p><strong>Treatment variable:</strong> Converted to numeric binary (0/1) to avoid
multi-level factor interactions. The first level (alphabetically or numerically)
becomes 0, the second becomes 1.</p></li>
<li><p><strong>Factor covariates:</strong> Automatic contrast coding based on shrinkage type:</p><ul><li><p><strong>Shrunk terms:</strong> One-hot encoding (all factor levels represented).
For proper regularization, specify these using <code>~ 0 + var</code> to explicitly remove
the intercept and treat all subgroups symmetrically without privileging a specific
reference group (ensures the exchangeability assumption).</p></li>
<li><p><strong>Unshrunk terms:</strong> Dummy encoding (reference level dropped).
Use standard formula syntax <code>~ var</code> with intercept.</p></li>
</ul></li>
<li><p><strong>Custom contrasts:</strong> If you have pre-specified contrasts via
<code>contrasts(data$var) &lt;- &lt;matrix&gt;</code> before calling this function, they will
be preserved. Otherwise, defaults are applied based on shrinkage category.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="stratification">Stratification<a class="anchor" aria-label="anchor" href="#stratification"></a></h2>


<p>The <code>stratification_formula_str</code> argument allows for estimating certain parameters
separately for different groups. Its behavior depends on the <code>response_type</code>:</p><ul><li><p><code>survival</code>: Estimates a separate baseline hazard function (<code>bhaz</code>) for
each level of the stratification variable.</p></li>
<li><p><code>continuous</code>: Models the residual standard deviation (<code>sigma</code>) as varying
across levels of the stratification variable.</p></li>
<li><p><code>count</code>: Models the overdispersion parameter (<code>shape</code>) as varying
across levels of the stratification variable.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/paul-buerkner/brms" class="external-link">"brms"</a></span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/therneau/survival" class="external-link">"survival"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># 1. Create Sample Data</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    subgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sim_data</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">trt</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sim_data</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sim_data</span><span class="op">$</span><span class="va">subgroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">subgroup</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 2a. Example with colon interaction syntax</span></span></span>
<span class="r-in"><span>  <span class="va">prepared_model</span> <span class="op">&lt;-</span> <span class="fu">prepare_formula_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">sim_data</span>,</span></span>
<span class="r-in"><span>    response_formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">trt</span>,</span></span>
<span class="r-in"><span>    unshrunk_terms_formula <span class="op">=</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">subgroup</span>,</span></span>
<span class="r-in"><span>    shrunk_predictive_formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span><span class="op">:</span><span class="va">subgroup</span>,</span></span>
<span class="r-in"><span>    response_type <span class="op">=</span> <span class="st">"survival"</span>,</span></span>
<span class="r-in"><span>    stratification_formula <span class="op">=</span> <span class="op">~</span> <span class="va">region</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 2b. Alternatively, using pipe-pipe (||) syntax</span></span></span>
<span class="r-in"><span>  <span class="co"># prepared_model &lt;- prepare_formula_model(</span></span></span>
<span class="r-in"><span>  <span class="co">#   data = sim_data,</span></span></span>
<span class="r-in"><span>  <span class="co">#   response_formula = Surv(time, status) ~ trt,</span></span></span>
<span class="r-in"><span>  <span class="co">#   unshrunk_terms_formula = ~ age,</span></span></span>
<span class="r-in"><span>  <span class="co">#   shrunk_predictive_formula = ~ (0 + trt || subgroup),</span></span></span>
<span class="r-in"><span>  <span class="co">#   response_type = "survival",</span></span></span>
<span class="r-in"><span>  <span class="co">#   stratification_formula = ~ region</span></span></span>
<span class="r-in"><span>  <span class="co"># )</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 3. View the results</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">prepared_model</span><span class="op">$</span><span class="va">formula</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prepared_model</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting treatment variable 'trt' to numeric binary (0/1). '0' = 0, '1' = 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Response type is 'survival'. Modeling the baseline hazard explicitly using bhaz().</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Applying stratification: estimating separate baseline hazards by 'region'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Note: Treatment 'trt' automatically added to unshrunk terms.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Note: Applied one-hot encoding to shrunken factor 'subgroup' (will be used with ~ 0 + ...)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Note: Applied dummy encoding (contr.treatment) to unshrunken factor 'subgroup'</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Formula 'shpredeffect' contains an intercept. For proper regularization/interpretation, consider removing it by adding '~ 0 + ...' or '~ -1 + ...' to your input formula.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time | cens(1 - status) + bhaz(Boundary.knots = c(0.02, 99.98), knots = c(24, 46, 69), intercept = FALSE, gr = region) ~ unshrunktermeffect + shpredeffect </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unshrunktermeffect ~ 0 + age + subgroup + trt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shpredeffect ~ trt:subgroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   time status trt      age region subgroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   29      0   1 57.87739      B       S2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   79      1   1 57.69042      B       S1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   41      1   1 53.32203      B       S3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   88      0   0 39.91623      B       S3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   94      1   1 48.80547      A       S3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    6      1   1 47.19605      A       S2</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miriam Pedrera Gomez, Isaac Gravestock, Marcel Wolbers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

