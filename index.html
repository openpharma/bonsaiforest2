<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Flexible Bayesian Shrinkage Based Forest Plots • bonsaiforest2</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="katex-auto.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Flexible Bayesian Shrinkage Based Forest Plots">
<meta name="description" content="An extension of the bonsaiforest package that provides increased flexibility in prior selection and modeling options. It supports four types of endpoints and simplifies the fitting and interpretation of Bayesian models for subgroup analysis. Leveraging brms, it distinguishes between prognostic and predictive factors using differential shrinkage priors and generates publication-ready forest plots.">
<meta property="og:description" content="An extension of the bonsaiforest package that provides increased flexibility in prior selection and modeling options. It supports four types of endpoints and simplifies the fitting and interpretation of Bayesian models for subgroup analysis. Leveraging brms, it distinguishes between prognostic and predictive factors using differential shrinkage priors and generates publication-ready forest plots.">
<meta property="og:image" content="https://openpharma.github.io/bonsaiforest2/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">bonsaiforest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Advanced_Functionalities.html">Advanced Functionalities</a></li>
    <li><a class="dropdown-item" href="articles/Quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="articles/Statistical_Specifications.html">Statistical Specifications</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/bonsaiforest2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="bonsaiforest2-">bonsaiforest2 
<a class="anchor" aria-label="anchor" href="#bonsaiforest2-"></a>
</h1>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>bonsaiforest2</code> package is used for Bayesian shrinkage estimation of subgroup treatment effects in randomized clinical trials. It supports both One-Variable-at-a-Time (OVAT) and Global modeling approaches for estimating treatment-by-subgroup interactions, with built-in support for continuous, binary, time-to-event (Cox), and count outcomes. The package implements state-of-the-art shrinkage priors including Regularized Horseshoe and R2D2, combined with standardization (G-computation) to provide interpretable marginal treatment effects. By leveraging <code>brms</code> and <code>Stan</code>, <code>bonsaiforest2</code> provides a practical tool for obtaining more stable and reliable subgroup effect estimates in exploratory analyses.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><strong>UPDATE TO USUAL INSTALLATION</strong> You can install the development version of <code>bonsaiforest2</code> from its GitLab repository:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes") </span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"openpharma/bonsaiforest2"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This example demonstrates the usage of <code>bonsaiforest2</code> for subgroup treatment effect estimation across multiple overlapping subgroups (Age, Region, and Biomarker) using a Global Modeling approach with a Regularized Horseshoe prior.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/bonsaiforest2/">bonsaiforest2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Simulate trial data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">trial_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  outcome  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>  trt      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Active"</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  age_cat  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;65"</span>, <span class="st">"&gt;=65"</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  region   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"EU"</span>, <span class="st">"Asia"</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  biomarker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pos"</span>, <span class="st">"Neg"</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Fit a Global Model with default priors</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_brms_analysis.html">run_brms_analysis</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trial_data</span>,</span>
<span>  response_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  response_formula <span class="op">=</span> <span class="va">outcome</span> <span class="op">~</span> <span class="va">trt</span>,</span>
<span>  unshrunk_terms_formula <span class="op">=</span> <span class="op">~</span> <span class="va">age_cat</span> <span class="op">+</span> <span class="va">region</span> <span class="op">+</span> <span class="va">biomarker</span>, </span>
<span>  shrunk_predictive_formula <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">age_cat</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">region</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">biomarker</span>, </span>
<span>  sigma_ref <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span>, warmup <span class="op">=</span> <span class="fl">500</span> <span class="co">#</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: Preparing formula and data...</span></span>
<span><span class="co">#&gt; Converting treatment variable 'trt' to numeric binary (0/1). 'Active' = 0, 'Control' = 1</span></span>
<span><span class="co">#&gt; Note: Treatment 'trt' automatically added to unshrunk terms.</span></span>
<span><span class="co">#&gt; Note: Applied one-hot encoding to shrunken factor 'age_cat' (will be used with ~ 0 + ...)</span></span>
<span><span class="co">#&gt; Note: Applied one-hot encoding to shrunken factor 'region' (will be used with ~ 0 + ...)</span></span>
<span><span class="co">#&gt; Note: Applied one-hot encoding to shrunken factor 'biomarker' (will be used with ~ 0 + ...)</span></span>
<span><span class="co">#&gt; Note: Applied dummy encoding (contr.treatment) to unshrunken factor 'age_cat'</span></span>
<span><span class="co">#&gt; Note: Applied dummy encoding (contr.treatment) to unshrunken factor 'region'</span></span>
<span><span class="co">#&gt; Note: Applied dummy encoding (contr.treatment) to unshrunken factor 'biomarker'</span></span>
<span><span class="co">#&gt; DEBUG: Creating sub-formulas...</span></span>
<span><span class="co">#&gt;   - all_unshrunk_terms: age_cat, region, biomarker, trt</span></span>
<span><span class="co">#&gt;   - shrunk_prog_terms:</span></span>
<span><span class="co">#&gt;   - shrunk_pred_formula: trt:age_cat + trt:region + trt:biomarker</span></span>
<span><span class="co">#&gt; DEBUG: Final formula object:</span></span>
<span><span class="co">#&gt; outcome ~ unshrunktermeffect + shpredeffect </span></span>
<span><span class="co">#&gt; unshrunktermeffect ~ age_cat + region + biomarker + trt</span></span>
<span><span class="co">#&gt; shpredeffect ~ 0 + trt:age_cat + trt:region + trt:biomarker</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step 2: Fitting the brms model...</span></span>
<span><span class="co">#&gt; Using trt_var from prepared_model: trt</span></span>
<span><span class="co">#&gt; Using sigma_ref = 3</span></span>
<span><span class="co">#&gt; Computed outcome mean: -0.027</span></span>
<span><span class="co">#&gt; Using default priors for unspecified effects:</span></span>
<span><span class="co">#&gt;   - intercept: normal(-0.027484445779618, 15)</span></span>
<span><span class="co">#&gt;   - unshrunk terms: normal(0, 15)</span></span>
<span><span class="co">#&gt;   - shrunk predictive: horseshoe(1)</span></span>
<span><span class="co">#&gt; Adding sigma prior: normal(0, 3)</span></span>
<span><span class="co">#&gt; Fitting brms model...</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Trying to compile a simple C file</span></span>
<span><span class="co">#&gt; Running /usr/lib/R/bin/R CMD SHLIB foo.c</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span>
<span><span class="co">#&gt; gcc -I"/usr/share/R/include" -DNDEBUG   -I"/usr/local/lib/R/site-library/Rcpp/include/"  -I"/usr/local/lib/R/site-library/RcppEigen/include/"  -I"/usr/local/lib/R/site-library/RcppEigen/include/unsupported"  -I"/usr/local/lib/R/site-library/BH/include" -I"/home/pedreram/R/x86_64-pc-linux-gnu-library/4.4/StanHeaders/include/src/"  -I"/home/pedreram/R/x86_64-pc-linux-gnu-library/4.4/StanHeaders/include/"  -I"/usr/local/lib/R/site-library/RcppParallel/include/"  -I"/home/pedreram/R/x86_64-pc-linux-gnu-library/4.4/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/home/pedreram/R/x86_64-pc-linux-gnu-library/4.4/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1       -fpic  -g -O2 -ffile-prefix-map=/build/r-base-JpkSDg/r-base-4.4.3=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2  -c foo.c -o foo.o</span></span>
<span><span class="co">#&gt; In file included from /usr/local/lib/R/site-library/RcppEigen/include/Eigen/Core:19,</span></span>
<span><span class="co">#&gt;                  from /usr/local/lib/R/site-library/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/pedreram/R/x86_64-pc-linux-gnu-library/4.4/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /usr/local/lib/R/site-library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: cmath: No such file or directory</span></span>
<span><span class="co">#&gt;   679 | #include &lt;cmath&gt;</span></span>
<span><span class="co">#&gt;       |          ^~~~~~~</span></span>
<span><span class="co">#&gt; compilation terminated.</span></span>
<span><span class="co">#&gt; make: *** [/usr/lib/R/etc/Makeconf:195: foo.o] Error 1</span></span>
<span><span class="co">#&gt; Start sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 6.9e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.69 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.997 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                0.937 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                1.934 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Gradient evaluation took 3.5e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.35 seconds.</span></span>
<span><span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2:  Elapsed Time: 1.008 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 2:                0.711 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2:                1.719 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 2:</span></span>
<span><span class="co">#&gt; Warning: There were 2 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Analysis complete.</span></span>
<span></span>
<span><span class="co"># 3. Derive Marginal Treatment Effects</span></span>
<span><span class="va">subgroup_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/summary_subgroup_effects.html">summary_subgroup_effects</a></span><span class="op">(</span></span>
<span>  brms_fit <span class="op">=</span> <span class="va">fit</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Using trt_var from model attributes: trt</span></span>
<span><span class="co">#&gt; Using response_type from model attributes: continuous</span></span>
<span><span class="co">#&gt; --- Calculating specific subgroup effects... ---</span></span>
<span><span class="co">#&gt; Using data from model attributes</span></span>
<span><span class="co">#&gt; Step 1: Identifying subgroups and creating counterfactuals...</span></span>
<span><span class="co">#&gt; `subgroup_vars` set to 'auto'. Detecting from model...</span></span>
<span><span class="co">#&gt; Model data has 200 rows and 5 columns</span></span>
<span><span class="co">#&gt; Column names: outcome, trt, age_cat, region, biomarker</span></span>
<span><span class="co">#&gt; Treatment variable: 'trt'</span></span>
<span><span class="co">#&gt; All coefficient names:</span></span>
<span><span class="co">#&gt; unshrunktermeffect_Intercept</span></span>
<span><span class="co">#&gt; unshrunktermeffect_age_cat&gt;EQ65</span></span>
<span><span class="co">#&gt; unshrunktermeffect_regionEU</span></span>
<span><span class="co">#&gt; unshrunktermeffect_regionUS</span></span>
<span><span class="co">#&gt; unshrunktermeffect_biomarkerPos</span></span>
<span><span class="co">#&gt; unshrunktermeffect_trt</span></span>
<span><span class="co">#&gt; shpredeffect_trt:age_cat&lt;65</span></span>
<span><span class="co">#&gt; shpredeffect_trt:age_cat&gt;EQ65</span></span>
<span><span class="co">#&gt; shpredeffect_trt:regionEU</span></span>
<span><span class="co">#&gt; shpredeffect_trt:regionUS</span></span>
<span><span class="co">#&gt; shpredeffect_trt:biomarkerPos</span></span>
<span><span class="co">#&gt; Looking for treatment interactions with pattern: 'trt:'</span></span>
<span><span class="co">#&gt; Found 5 treatment interaction coefficients</span></span>
<span><span class="co">#&gt; Treatment interaction coefficients found:</span></span>
<span><span class="co">#&gt; shpredeffect_trt:age_cat&lt;65</span></span>
<span><span class="co">#&gt; shpredeffect_trt:age_cat&gt;EQ65</span></span>
<span><span class="co">#&gt; shpredeffect_trt:regionEU</span></span>
<span><span class="co">#&gt; shpredeffect_trt:regionUS</span></span>
<span><span class="co">#&gt; shpredeffect_trt:biomarkerPos</span></span>
<span><span class="co">#&gt; Detected subgroup variable 'age_cat' from coefficient 'shpredeffect_trt:age_cat&lt;65'</span></span>
<span><span class="co">#&gt; Detected subgroup variable 'age_cat' from coefficient 'shpredeffect_trt:age_cat&gt;EQ65'</span></span>
<span><span class="co">#&gt; Detected subgroup variable 'region' from coefficient 'shpredeffect_trt:regionEU'</span></span>
<span><span class="co">#&gt; Detected subgroup variable 'region' from coefficient 'shpredeffect_trt:regionUS'</span></span>
<span><span class="co">#&gt; Detected subgroup variable 'biomarker' from coefficient 'shpredeffect_trt:biomarkerPos'</span></span>
<span><span class="co">#&gt; Checking for random effects parameters...</span></span>
<span><span class="co">#&gt; Retrieved 21 total parameters from model</span></span>
<span><span class="co">#&gt; Using regex pattern: '^r_(.+)__[^\[]+\[[^,]+,trt\]'</span></span>
<span><span class="co">#&gt; Found 0 matching random effect parameters</span></span>
<span><span class="co">#&gt; No random effect parameters matching the pattern were found</span></span>
<span><span class="co">#&gt; ...detected subgroup variable(s): age_cat, region, biomarker</span></span>
<span><span class="co">#&gt; Step 2: Generating posterior predictions...</span></span>
<span><span class="co">#&gt; ... detected Fixed Effects (Colon model). Predicting with re_formula = NA.</span></span>
<span><span class="co">#&gt; ... (predicting expected outcomes)...</span></span>
<span><span class="co">#&gt; Step 3: Calculating marginal effects...</span></span>
<span><span class="co">#&gt; ... processing age_cat</span></span>
<span><span class="co">#&gt; ... processing region</span></span>
<span><span class="co">#&gt; ... processing biomarker</span></span>
<span><span class="co">#&gt; Done.</span></span>
<span></span>
<span><span class="co"># 4. Visualize Results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subgroup_effects</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparing data for plotting...</span></span>
<span><span class="co">#&gt; Generating plot...</span></span>
<span><span class="co">#&gt; Done.</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/openpharma/bonsaiforest2/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/openpharma/bonsaiforest2/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bonsaiforest2</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Miriam Pedrera Gomez <br><small class="roles"> Author, maintainer </small>   </li>
<li>Isaac Gravestock <br><small class="roles"> Author </small>   </li>
<li>Marcel Wolbers <br><small class="roles"> Author </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miriam Pedrera Gomez, Isaac Gravestock, Marcel Wolbers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
