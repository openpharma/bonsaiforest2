% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_brms_analysis.R
\name{run_brms_analysis}
\alias{run_brms_analysis}
\title{Run a Full Bayesian Hierarchical Model Analysis}
\usage{
run_brms_analysis(
  data,
  response_formula,
  response_type = c("binary", "count", "continuous", "survival"),
  unshrunk_terms_formula = NULL,
  shrunk_prognostic_formula = NULL,
  shrunk_predictive_formula = NULL,
  stratification_formula = NULL,
  intercept_prior = NULL,
  unshrunk_prior = NULL,
  shrunk_prognostic_prior = NULL,
  shrunk_predictive_prior = NULL,
  stanvars = NULL,
  ...
)
}
\arguments{
\item{data}{A data frame. Dataset containing all necessary variables including response,
treatment, and covariates. Passed to \code{prepare_formula_model()} for preprocessing.}

\item{response_formula}{A formula object. Response specification defining the outcome and
treatment. Examples: \code{outcome ~ trt} for continuous, or \code{Surv(time, status) ~ trt} for
survival. Passed to \code{prepare_formula_model()}.}

\item{response_type}{A character string. Outcome type, one of \code{"binary"}, \code{"count"},
\code{"continuous"}, or \code{"survival"}. Determines the likelihood function and link used.
Passed to \code{prepare_formula_model()}.}

\item{unshrunk_terms_formula}{A formula object or \code{NULL}. Unshrunk terms specification for
the \code{unshrunktermeffect} component. May include main effects and treatment interactions
without regularization (e.g., \code{~ age + sex + trt*region}). Passed to \code{prepare_formula_model()}.}

\item{shrunk_prognostic_formula}{A formula object or \code{NULL}. Prognostic effects for strong
regularization in the \code{shprogeffect} component.
\itemize{
\item \strong{Fixed effects (colon syntax):} Use \code{~ 0 + ...} syntax for one-hot encoding
(e.g., \code{~ 0 + biomarker1 + biomarker2}).
\item \strong{Random effects (one-way model, pipe-pipe syntax):} Use random effects notation
(e.g., \code{~ (0 + 1 || biomarker)}) with automatic \code{normal(0, 1)} priors on SD scale.
Passed to \code{prepare_formula_model()}.
}}

\item{shrunk_predictive_formula}{A formula object or \code{NULL}. Treatment interactions for strong
regularization in the \code{shpredeffect} component.
\itemize{
\item \strong{Fixed effects (colon syntax):} Use \code{~ 0 + ...} syntax for one-hot encoding
(e.g., \code{~ 0 + trt:subgroup}).
\item \strong{Random effects (one-way model, pipe-pipe syntax):} Use random effects notation
(e.g., \code{~ (0 + trt || subgroup)}) with automatic \code{normal(0, 1)} priors on SD scale.
Passed to \code{prepare_formula_model()}.
}}

\item{stratification_formula}{A formula object or \code{NULL}. Stratification variable specification
(e.g., \code{~ strata_var}). For survival models, estimates separate baseline hazards per stratum.
For other models, models varying distributional parameters. Passed to \code{prepare_formula_model()}.}

\item{intercept_prior}{A character string, \code{brmsprior} object, or \code{NULL}. Intercept prior for
\code{unshrunktermeffect} component. Not used for survival models (Cox models have no intercept).
Example: \code{"normal(0, 10)"}. Passed to \code{fit_brms_model()}.}

\item{unshrunk_prior}{A character string, \code{brmsprior} object, or \code{NULL}. Prior for unshrunk
terms (non-intercept coefficients in \code{unshrunktermeffect} component).
Example: \code{"normal(0, 2.5)"}. Passed to \code{fit_brms_model()}.}

\item{shrunk_prognostic_prior}{A character string, \code{brmsprior} object, or \code{NULL}. Prior for
regularized prognostic effects in \code{shprogeffect} component.
\itemize{
\item \strong{Fixed effects:} Typically strong regularization like \code{"horseshoe(scale_global = 1)"}.
\item \strong{Random effects (one-way model):} Automatically uses \code{normal(0, 1)} priors on SD scale.
Passed to \code{fit_brms_model()}.
}}

\item{shrunk_predictive_prior}{A character string, \code{brmsprior} object, or \code{NULL}. Prior for
regularized predictive effects (treatment interactions) in \code{shpredeffect} component.
\itemize{
\item \strong{Fixed effects:} Typically strong regularization like
\code{"horseshoe(scale_global = 0.5)"}.
\item \strong{Random effects (one-way model):} Automatically uses \code{normal(0, 1)} priors on SD scale.
Passed to \code{fit_brms_model()}.
}}

\item{stanvars}{A \code{stanvars} object or \code{NULL}. Custom Stan code created via \code{brms::stanvar()}
for implementing hierarchical priors or other advanced Stan functionality. Passed to \code{fit_brms_model()}.}

\item{...}{Additional arguments passed to \code{brms::brm()} via \code{fit_brms_model()}. Common
arguments include \code{chains}, \code{iter}, \code{cores}, \code{backend}, and \code{refresh}.}
}
\value{
\code{brmsfit}. Fitted Bayesian model object with attached attributes: \code{response_type},
\code{model_data} (the processed data used for fitting), and \code{trt_var} (treatment variable name)
for use by downstream analysis functions.
}
\description{
This high-level wrapper function streamlines the entire process of preparing
and fitting a complex Bayesian hierarchical model with \code{brms}. It serves as a
convenient single entry point for the complete workflow.
}
\details{
This function is the main user-facing entry point. It first calls
\code{prepare_formula_model()} to build the \code{brmsformula} and process the data,
then passes the results to \code{fit_brms_model()} to run the analysis.
}
\examples{
if (require("brms") && require("survival")) {
  # 1. Create Sample Data
  set.seed(123)
  n <- 100
  sim_data <- data.frame(
    time = round(runif(n, 1, 100)),
    status = sample(0:1, n, replace = TRUE),
    trt = sample(0:1, n, replace = TRUE),
    age = rnorm(n, 50, 10),
    region = sample(c("A", "B"), n, replace = TRUE),
    subgroup = sample(c("S1", "S2", "S3"), n, replace = TRUE)
  )
  sim_data$trt <- factor(sim_data$trt, levels = c(0, 1))
  sim_data$region <- as.factor(sim_data$region)
  sim_data$subgroup <- as.factor(sim_data$subgroup)

  # 2. Run the full analysis using fixed effects (colon syntax)
  \dontrun{
  full_fit_fixed <- run_brms_analysis(
    data = sim_data,
    response_formula = Surv(time, status) ~ trt,
    response_type = "survival",
    unshrunk_terms_formula = ~ age,
    shrunk_prognostic_formula = ~ 0 + region,
    shrunk_predictive_formula = ~ 0 + trt:subgroup,
    stratification_formula = ~ region,
    unshrunk_prior = "normal(0, 2)",
    shrunk_prognostic_prior = "horseshoe(scale_global = 1)",
    shrunk_predictive_prior = "horseshoe(scale_global = 1)",
    backend = "cmdstanr",
    chains = 2, iter = 1000, warmup = 500, refresh = 0
  )

  print(full_fit_fixed)

  # 3. Alternative: One-way model with random effects (pipe-pipe syntax)
  # Random effects automatically get normal(0, 1) priors on SD scale
  full_fit_oneway <- run_brms_analysis(
    data = sim_data,
    response_formula = Surv(time, status) ~ trt,
    response_type = "survival",
    unshrunk_terms_formula = ~ age,
    shrunk_prognostic_formula = ~ (0 + 1 || region),
    shrunk_predictive_formula = ~ (0 + trt || subgroup),
    stratification_formula = ~ region,
    backend = "cmdstanr",
    chains = 2, iter = 1000, warmup = 500, refresh = 0
  )

  print(full_fit_oneway)
  }
}
}
